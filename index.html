<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOWV1RE - –ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö —É—Å–ª—É–≥</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg width='64' height='64' viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='400' height='400' fill='%230a0a0a' rx='40'/%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235ba3f5'/%3E%3Cstop offset='100%25' style='stop-color:%234A90E2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M 120 80 L 120 320 L 300 320 L 300 260 L 190 260 L 190 220 L 230 260 L 190 260 L 190 80 Z' fill='url(%23g)' stroke='%235ba3f5' stroke-width='4'/%3E%3Cpath d='M 190 220 L 230 260 L 190 260 Z' fill='%230a0a0a'/%3E%3C/svg%3E">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --bg-primary: #0a0a0a;
    --bg-secondary: #121212;
    --bg-tertiary: #1e1e23;
    --border-color: #2a2a2f;
    --text-primary: #ffffff;
    --text-secondary: #b0b0b0;
    --accent-blue: #4A90E2;
}

body.light-theme {
    --bg-primary: #ffffff;
    --bg-secondary: #f5f5f5;
    --bg-tertiary: #e8e8e8;
    --border-color: #d0d0d0;
    --text-primary: #000000;
    --text-secondary: #666666;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
}

/* Header */
.header {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--bg-tertiary);
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 70px;
}

.logo {
    font-size: 28px;
    font-weight: 700;
    color: var(--accent-blue);
    text-decoration: none;
    letter-spacing: -0.5px;
    display: flex;
    align-items: center;
    gap: 10px;
    margin-left: -10px;
}

.logo:hover {
    color: #5ba3f5;
}

.nav-links {
    display: flex;
    gap: 40px;
    align-items: center;
}

.nav-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-weight: 500;
    font-size: 15px;
    transition: color 0.3s;
}

.nav-links a:hover {
    color: var(--text-primary);
}

.lang-switch {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s;
}

.lang-switch:hover {
    background: var(--border-color);
    color: var(--text-primary);
}

/* Currency switcher */
.currency-switch {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s;
}

.currency-switch:hover {
    background: var(--border-color);
    color: var(--text-primary);
}

/* Theme toggle */
.theme-toggle {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 42px;
    height: 38px;
}

.theme-toggle:hover {
    background: var(--border-color);
    transform: rotate(15deg);
}

.controls-group {
    display: flex;
    gap: 12px;
    align-items: center;
}

/* Mobile menu button */
.mobile-menu-btn {
    display: none;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 24px;
    color: var(--text-primary);
    transition: all 0.3s;
}

.mobile-menu-btn:hover {
    background: var(--border-color);
}

/* Mobile menu overlay */
.mobile-menu-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 9998;
}

.mobile-menu-overlay.active {
    display: block;
}

/* Mobile menu panel */
.mobile-menu {
    display: none;
    position: fixed;
    top: 0;
    right: -300px;
    width: 280px;
    height: 100%;
    background: var(--bg-secondary);
    border-left: 1px solid var(--border-color);
    z-index: 9999;
    padding: 80px 24px 24px;
    transition: right 0.3s ease;
    overflow-y: auto;
}

.mobile-menu.active {
    right: 0;
}

.mobile-menu-close {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 32px;
    color: var(--text-secondary);
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
}

.mobile-menu-item {
    margin-bottom: 24px;
}

.mobile-menu-label {
    display: block;
    color: var(--text-secondary);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.mobile-menu .currency-switch,
.mobile-menu .lang-switch,
.mobile-menu .theme-toggle {
    width: 100%;
    text-align: left;
}

@media (max-width: 768px) {
    .nav-links {
        display: none;
    }
    
    .mobile-menu-btn {
        display: block;
    }
    
    .mobile-menu {
        display: block;
    }
}

/* Hero Section */
.hero {
    padding: 100px 20px;
    text-align: center;
    background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
}

.hero h1 {
    font-size: 56px;
    font-weight: 800;
    margin-bottom: 20px;
    background: linear-gradient(135deg, var(--accent-blue), #7B68EE);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero p {
    font-size: 20px;
    color: var(--text-secondary);
    margin-bottom: 40px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.cta-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn {
    padding: 14px 32px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: linear-gradient(135deg, var(--accent-blue), #667eea);
    color: #ffffff;
    box-shadow: 0 4px 20px rgba(74, 144, 226, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 30px rgba(74, 144, 226, 0.4);
}

.btn-secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}

.btn-secondary:hover {
    background: var(--border-color);
    border-color: var(--accent-blue);
}

/* Games Section */
.games-section {
    padding: 80px 20px;
}

.section-title {
    font-size: 36px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 50px;
}

/* Game Search */
.game-search-container {
    max-width: 600px;
    margin: 0 auto 40px;
    position: relative;
}

.game-search-input {
    width: 100%;
    padding: 16px 50px 16px 20px;
    background: var(--bg-secondary);
    border: 2px solid var(--bg-tertiary);
    border-radius: 16px;
    color: var(--text-primary);
    font-size: 16px;
    transition: all 0.3s;
}

.game-search-input:focus {
    outline: none;
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
}

.game-search-input::placeholder {
    color: var(--text-secondary);
}

.game-search-icon {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 20px;
    color: var(--text-secondary);
    pointer-events: none;
}

.no-results {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
    font-size: 18px;
}

.no-results-icon {
    font-size: 48px;
    margin-bottom: 16px;
}

.games-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 24px;
    max-width: 1400px;
    margin: 0 auto;
}

@media (max-width: 1200px) {
    .games-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .games-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .games-grid {
        grid-template-columns: 1fr;
    }
}

.game-card {
    background: var(--bg-secondary);
    border: 1px solid var(--bg-tertiary);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s;
    cursor: pointer;
}

.game-card:hover {
    transform: translateY(-4px);
    border-color: var(--accent-blue);
    box-shadow: 0 8px 32px rgba(74, 144, 226, 0.15);
}

.game-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    margin-bottom: 20px;
    position: relative;
}

.game-icon::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 15px;
    background: var(--accent-blue);
    filter: blur(12px);
    opacity: 0.6;
    border-radius: 50%;
}

.game-card h3 {
    font-size: 22px;
    margin-bottom: 10px;
    color: #ffffff;
}

.game-card p {
    color: #b0b0b0;
    font-size: 14px;
    margin-bottom: 16px;
}

.game-price {
    margin-bottom: 16px;
}

.price-display {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent-blue);
    display: inline-block;
}

.price-tag {
    display: flex;
    gap: 16px;
    align-items: center;
    flex-wrap: wrap;
}

.price {
    font-size: 18px;
    font-weight: 700;
    color: #4A90E2;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--bg-secondary);
    border: 1px solid var(--bg-tertiary);
    border-radius: 20px;
    max-width: 480px;
    width: 100%;
    padding: 40px;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 28px;
    color: #666;
    cursor: pointer;
    transition: color 0.3s;
    background: none;
    border: none;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    color: #ffffff;
}

.modal-title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 30px;
    text-align: center;
    color: #ffffff;
}

.modal-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    background: #0a0a0a;
    padding: 6px;
    border-radius: 12px;
}

.tab {
    flex: 1;
    padding: 12px;
    text-align: center;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    color: #b0b0b0;
}

.tab.active {
    background: #1e1e23;
    color: #ffffff;
}

/* Form */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text-secondary);
    font-size: 14px;
}

.form-group input {
    width: 100%;
    padding: 14px 16px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    color: var(--text-primary);
    font-size: 15px;
    transition: all 0.3s;
}

.form-group input:focus {
    outline: none;
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
}

.form-group input.error {
    border-color: #FF4757;
}

.form-submit {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, var(--accent-blue), #667eea);
    border: none;
    border-radius: 10px;
    color: #ffffff;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
}

.form-submit:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.3);
}

.form-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.form-switch {
    text-align: center;
    margin-top: 20px;
    color: var(--text-secondary);
    font-size: 14px;
}

.form-switch a {
    color: var(--accent-blue);
    text-decoration: none;
    cursor: pointer;
    font-weight: 600;
}

.form-switch a:hover {
    text-decoration: underline;
}

/* Google Auth Button */
.google-btn {
    width: 100%;
    padding: 14px;
    background: white;
    color: #444;
    border: 1px solid #ddd;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-top: 16px;
}

.google-btn:hover {
    background: #f8f8f8;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.google-icon {
    width: 20px;
    height: 20px;
}

/* Cloudflare Turnstile */
.cf-turnstile {
    margin: 20px 0;
    display: flex;
    justify-content: center;
}

.divider {
    display: flex;
    align-items: center;
    text-align: center;
    margin: 24px 0 16px;
    color: var(--text-secondary);
    font-size: 14px;
}

.divider::before,
.divider::after {
    content: '';
    flex: 1;
    border-bottom: 1px solid var(--border-color);
}

.divider::before {
    margin-right: 16px;
}

.divider::after {
    margin-left: 16px;
}

/* Messages */
.error-msg, .success-msg {
    padding: 12px 16px;
    border-radius: 10px;
    margin-bottom: 20px;
    font-size: 14px;
    font-weight: 500;
}

.error-msg {
    background: rgba(255, 71, 87, 0.1);
    border: 1px solid rgba(255, 71, 87, 0.3);
    color: #FF4757;
}

.success-msg {
    background: rgba(0, 210, 106, 0.1);
    border: 1px solid rgba(0, 210, 106, 0.3);
    color: #00D26A;
}

/* Loading */
.loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: #ffffff;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    margin-right: 8px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Profile */
.profile-container {
    max-width: 800px;
    margin: 60px auto;
    padding: 0 20px;
}

.profile-section {
    background: var(--bg-secondary);
    border: 1px solid var(--bg-tertiary);
    border-radius: 24px;
    padding: 48px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.profile-header {
    display: flex;
    align-items: center;
    gap: 24px;
    margin-bottom: 40px;
    padding-bottom: 40px;
    border-bottom: 1px solid var(--bg-tertiary);
}

.profile-avatar {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, var(--accent-blue), #7B68EE);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
}

.profile-info {
    flex: 1;
}

.profile-info h2 {
    font-size: 32px;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.profile-info p {
    color: var(--text-secondary);
    font-size: 16px;
    margin: 4px 0;
}

.profile-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
    margin-bottom: 32px;
}

.stat-box {
    background: var(--bg-tertiary);
    padding: 24px;
    border-radius: 16px;
    text-align: center;
    transition: transform 0.3s;
}

.stat-box:hover {
    transform: translateY(-4px);
}

.stat-label {
    color: var(--text-secondary);
    font-size: 14px;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-value {
    color: var(--accent-blue);
    font-size: 24px;
    font-weight: 700;
}

.logout-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
}

@media (max-width: 768px) {
    .profile-section {
        padding: 32px 24px;
    }
    
    .profile-header {
        flex-direction: column;
        text-align: center;
    }
    
    .profile-stats {
        grid-template-columns: 1fr;
    }
}

/* User info in header */
.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 16px;
    background: var(--bg-tertiary);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
}

.user-info:hover {
    background: var(--border-color);
}

.user-avatar {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--accent-blue), #7B68EE);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: 700;
    color: white;
}

.user-name {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
}

.auth-btn {
    padding: 8px 20px;
    background: linear-gradient(135deg, var(--accent-blue), #7B68EE);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.auth-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
}

.balance-card {
    background: linear-gradient(135deg, #667eea, #764ba2);
    padding: 24px 32px;
    border-radius: 16px;
    text-align: center;
}

.balance-card p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    margin-bottom: 8px;
}

.balance-card h3 {
    font-size: 36px;
    font-weight: 700;
}

/* Footer / Contact Section */
.footer {
    max-width: 800px;
    margin: 80px auto 40px;
    padding: 48px;
    background: var(--bg-secondary);
    border: 1px solid var(--bg-tertiary);
    border-radius: 24px;
    text-align: center;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.footer h3 {
    font-size: 32px;
    margin-bottom: 16px;
    background: linear-gradient(135deg, var(--accent-blue), #7B68EE);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.footer p {
    color: var(--text-secondary);
    font-size: 16px;
    margin-bottom: 32px;
}

.contact {
    display: flex;
    gap: 24px;
    justify-content: center;
    flex-wrap: wrap;
}

.contact a {
    padding: 14px 28px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    color: var(--text-primary);
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.contact a:hover {
    background: var(--accent-blue);
    color: white;
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(74, 144, 226, 0.3);
}

@media (max-width: 768px) {
    .footer {
        padding: 32px 24px;
        margin: 60px 20px 40px;
    }
    
    .footer h3 {
        font-size: 24px;
    }
    
    .contact {
        flex-direction: column;
    }
}

/* Responsive */
@media (max-width: 768px) {
    .hero h1 {
        font-size: 36px;
    }
    
    .hero p {
        font-size: 16px;
    }
    
    .nav-links {
        display: none;
    }
    
    .games-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        padding: 30px 20px;
    }
}
</style>
</head>
<body>
<div class="content-wrapper">
<div class="header" id="header">
<div class="container">
<div class="nav">
<a href="#" class="logo" onclick="window.location.reload()">üéÆ LOWV1RE</a>
<div class="nav-links">
<a href="#games" data-lang-text="–ò–≥—Ä—ã|Games">–ò–≥—Ä—ã</a>
<a href="#marketplace" onclick="showMarketplace()" data-lang-text="–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å|Marketplace">üõí –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</a>
<a href="#chats" onclick="showChats()" class="chats-link" data-lang-text="–ß–∞—Ç—ã|Chats" style="position:relative;">
    üí¨ –ß–∞—Ç—ã
    <span id="unreadBadge" style="position:absolute;top:-8px;right:-12px;background:#ff4444;color:white;border-radius:10px;padding:2px 6px;font-size:11px;font-weight:bold;display:none;">0</span>
</a>
<a href="#services" data-lang-text="–£—Å–ª—É–≥–∏|Services">–£—Å–ª—É–≥–∏</a>
<a href="#contact" data-lang-text="–ö–æ–Ω—Ç–∞–∫—Ç—ã|Contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
<div id="authSection"></div>
<div class="controls-group">
<select class="currency-switch" id="currencySwitch">
<option value="RUB">‚ÇΩ RUB</option>
<option value="USD">$ USD</option>
<option value="EUR">‚Ç¨ EUR</option>
</select>
<button class="theme-toggle" id="themeToggle" title="Toggle theme">üåô</button>
<div class="lang-switch" id="langSwitch">RU</div>
</div>
</div>
<button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleMobileMenu()">‚ò∞</button>
</div>
</div>
</div>

<!-- Mobile Menu -->
<div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>
<div class="mobile-menu" id="mobileMenu">
<button class="mobile-menu-close" onclick="closeMobileMenu()">√ó</button>

<div class="mobile-menu-item">
<div class="mobile-menu-label" data-lang-text="–í–∞–ª—é—Ç–∞|Currency">–í–∞–ª—é—Ç–∞</div>
<select class="currency-switch" id="currencySwitchMobile" onchange="changeCurrency()">
<option value="RUB">‚ÇΩ RUB</option>
<option value="USD">$ USD</option>
<option value="EUR">‚Ç¨ EUR</option>
</select>
</div>

<div class="mobile-menu-item">
<div class="mobile-menu-label" data-lang-text="–¢–µ–º–∞|Theme">–¢–µ–º–∞</div>
<button class="theme-toggle" id="themeToggleMobile" style="width:100%;justify-content:center;" onclick="toggleTheme()" title="Toggle theme">üåô</button>
</div>

<div class="mobile-menu-item">
<div class="mobile-menu-label" data-lang-text="–Ø–∑—ã–∫|Language">–Ø–∑—ã–∫</div>
<div class="lang-switch" id="langSwitchMobile" style="width:100%;justify-content:center;cursor:pointer;">RU</div>
</div>

<div class="mobile-menu-item" style="margin-top:32px;">
<div id="authSectionMobile"></div>
</div>
</div>

<div class="hero">
<div class="container">
<h1 id="heroTitle" data-lang-text="LOWV1RE MARKET|LOWV1RE MARKET">LOWV1RE MARKET</h1>
<p id="heroDesc" data-lang-text="–î–æ–Ω–∞—Ç. –ê–∫–∫–∞—É–Ω—Ç—ã. –ü—Ä–æ–∫–∞—á–∫–∞. –í—Å—ë –ø–æ–¥ —Ç–≤–æ–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.|Donations. Accounts. Boosting. Everything under your control.">–î–æ–Ω–∞—Ç. –ê–∫–∫–∞—É–Ω—Ç—ã. –ü—Ä–æ–∫–∞—á–∫–∞. –í—Å—ë –ø–æ–¥ —Ç–≤–æ–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.</p>
<div class="cta-buttons" id="heroButtons">
<button class="btn btn-primary" onclick="openModal('loginModal')" data-lang-text="–í–æ–π—Ç–∏|Login">–í–æ–π—Ç–∏</button>
<button class="btn btn-secondary" onclick="openModal('registerModal')" data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è|Register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>
</div>
</div>

<div id="profileSection" style="display:none;">
<div class="container">
<div class="profile-section">
<div class="profile-header">
<div style="position:relative;">
    <div class="profile-avatar" id="profileAvatar">U</div>
    <label for="profileAvatarInput" style="position:absolute;bottom:0;right:0;background:#5ba3f5;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;border:3px solid var(--bg-primary);transition:all 0.2s;">
        <span style="font-size:16px;">üì∑</span>
    </label>
    <input type="file" id="profileAvatarInput" accept="image/*" style="display:none;" onchange="handleProfileAvatarUpload(event)">
</div>
<div class="profile-info">
<h2 id="profileUsername">Username</h2>
<p id="profileEmail">email@example.com</p>
<p id="profileUrl" style="color:#ff8c00; margin-top:5px; font-size:16px;">lowv1re.eu/user1</p>
</div>
</div>
<div class="profile-stats">
<div class="stat-box">
<div class="stat-label" data-lang-text="–ë–∞–ª–∞–Ω—Å|Balance">–ë–∞–ª–∞–Ω—Å</div>
<div class="stat-value" id="profileBalance">0‚ÇΩ</div>
</div>
<div class="stat-box">
<div class="stat-label" data-lang-text="–ó–∞–∫–∞–∑–æ–≤|Orders">–ó–∞–∫–∞–∑–æ–≤</div>
<div class="stat-value" id="profileOrders">0</div>
</div>
<div class="stat-box">
<div class="stat-label" data-lang-text="–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏|Registered">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
<div class="stat-value" id="profileDate" style="font-size:14px;">--</div>
</div>
<div class="stat-box">
<div class="stat-label" data-lang-text="–ú–æ–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤|My Items">–ú–æ–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤</div>
<div class="stat-value" id="profileItemsCount">0</div>
</div>
</div>
<div style="display:flex;gap:10px;margin-top:20px;margin-bottom:20px;">
<button class="form-submit" onclick="openModal('createItemModal')" style="flex:1;" data-lang-text="–í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä|List Item">üõí –í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
<button class="form-submit" onclick="showMyItems()" style="flex:1;background:#4A90E2;" data-lang-text="–ú–æ–∏ —Ç–æ–≤–∞—Ä—ã|My Items">üì¶ –ú–æ–∏ —Ç–æ–≤–∞—Ä—ã</button>
</div>
<button class="logout-btn" onclick="logout()" data-lang-text="–í—ã–π—Ç–∏|Logout">–í—ã–π—Ç–∏</button>
</div>
</div>
</div>

<!-- –ú–ê–†–ö–ï–¢–ü–õ–ï–ô–° -->
<div id="marketplaceSection" style="display:none;">
<div class="container">
<div class="profile-section">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;">
<h2 class="section-title" style="margin:0;" data-lang-text="üõí –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å|üõí Marketplace">üõí –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</h2>
<button class="form-submit" onclick="openModal('createItemModal')" data-lang-text="–í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä|List Item">+ –í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div style="display:flex;gap:15px;margin-bottom:25px;flex-wrap:wrap;">
<select id="gameFilter" class="currency-switch" style="flex:1;min-width:200px;" onchange="filterMarketplace()">
<option value="" data-lang-text="–í—Å–µ –∏–≥—Ä—ã|All Games">–í—Å–µ –∏–≥—Ä—ã</option>
</select>
<input type="text" id="marketplaceSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞..." class="currency-switch" style="flex:2;min-width:250px;" oninput="filterMarketplace()" data-lang-placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞...|Search item...">
<select id="sortFilter" class="currency-switch" onchange="filterMarketplace()">
<option value="newest" data-lang-text="–ù–æ–≤—ã–µ|Newest">–ù–æ–≤—ã–µ</option>
<option value="price_asc" data-lang-text="–¶–µ–Ω–∞ ‚Üë|Price ‚Üë">–¶–µ–Ω–∞ ‚Üë</option>
<option value="price_desc" data-lang-text="–¶–µ–Ω–∞ ‚Üì|Price ‚Üì">–¶–µ–Ω–∞ ‚Üì</option>
</select>
</div>

<!-- –¢–æ–≤–∞—Ä—ã -->
<div id="marketplaceItems" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;">
<!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ -->
</div>

<div id="marketplaceEmpty" style="text-align:center;padding:60px 20px;color:var(--text-secondary);display:none;">
<div style="font-size:64px;margin-bottom:20px;">üì¶</div>
<h3 data-lang-text="–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤|No items yet">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</h3>
<p data-lang-text="–°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º –ø—Ä–æ–¥–∞–≤—Ü–æ–º!|Be the first seller!">–°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º –ø—Ä–æ–¥–∞–≤—Ü–æ–º!</p>
<button class="form-submit" onclick="openModal('createItemModal')" style="margin-top:20px;" data-lang-text="–í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä|List Item">–í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
</div>
</div>
</div>
</div>

<!-- –ß–ê–¢–´ -->
<div id="chatsSection" style="display:none;">
<div class="container">
<div class="profile-section">
<h2 class="section-title" data-lang-text="üí¨ –ß–∞—Ç—ã|üí¨ Chats">üí¨ –ß–∞—Ç—ã</h2>

<!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
<div id="chatsList" style="display:flex;flex-direction:column;gap:15px;">
<!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç —á–∞—Ç—ã -->
</div>

<div id="chatsEmpty" style="text-align:center;padding:60px 20px;color:var(--text-secondary);display:none;">
<div style="font-size:64px;margin-bottom:20px;">üí¨</div>
<h3 data-lang-text="–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤|No active chats">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤</h3>
<p data-lang-text="–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º|Start a conversation with a seller">–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º</p>
<button class="form-submit" onclick="showMarketplace()" style="margin-top:20px;" data-lang-text="–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å|Go to Marketplace">–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</button>
</div>
</div>
</div>
</div>

<!-- –ß–ê–¢ (–æ–¥–∏–Ω –¥–∏–∞–ª–æ–≥) -->
<div id="chatSection" style="display:none;">
<div class="container">
<div class="profile-section">
<!-- –®–∞–ø–∫–∞ —á–∞—Ç–∞ -->
<div style="display:flex;align-items:center;gap:15px;padding-bottom:20px;border-bottom:2px solid var(--border-color);margin-bottom:20px;">
<button onclick="showChats()" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--text-primary);">‚Üê</button>
<div class="profile-avatar" id="chatUserAvatar" style="width:50px;height:50px;font-size:20px;">U</div>
<div style="flex:1;">
<h3 id="chatUsername" style="margin:0;color:var(--text-primary);">Username</h3>
<p id="chatItemTitle" style="margin:5px 0 0 0;color:var(--text-secondary);font-size:14px;">–¢–æ–≤–∞—Ä</p>
</div>
</div>

<!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
<div id="messagesContainer" style="max-height:500px;overflow-y:auto;padding:20px;background:var(--bg-secondary);border-radius:15px;margin-bottom:20px;">
<!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è -->
</div>

<!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
<div style="display:flex;gap:10px;">
<input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1;padding:12px 20px;background:var(--bg-secondary);border:2px solid var(--border-color);border-radius:25px;color:var(--text-primary);font-size:15px;" onkeypress="if(event.key==='Enter') sendMessage()" data-lang-placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...|Write a message...">
<button onclick="sendMessage()" class="form-submit" style="padding:12px 30px;border-radius:25px;" data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å|Send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>
</div>
</div>
</div>

<div class="container" id="games">
<h2 class="section-title" data-lang-text="üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã|üéÆ Popular Games">üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã</h2>

<div class="game-search-container">
<input 
    type="text" 
    id="gameSearchInput" 
    class="game-search-input" 
    placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä—ã..."
    data-lang-placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä—ã...|Search game..."
    oninput="searchGames()"
>
<span class="game-search-icon">üîç</span>
</div>

<div class="games-grid" id="gamesGrid">

<div class="game-card card-apex" data-price="180">
<div>
<div class="game-icon">üéØ</div>
<h3 data-lang-text="Apex Legends|Apex Legends">Apex Legends</h3>
<p data-lang-text="Apex –º–æ–Ω–µ—Ç—ã, –ª–µ–≥–µ–Ω–¥—ã, –±–∞—Ç–ª-–ø–∞—Å—Å|Apex Coins, legends, battle pass">Apex –º–æ–Ω–µ—Ç—ã, –ª–µ–≥–µ–Ω–¥—ã, –±–∞—Ç–ª-–ø–∞—Å—Å</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 180‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Apex Legends', 180)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-brawl" data-price="100">
<div>
<div class="game-icon">‚≠ê</div>
<h3 data-lang-text="Brawl Stars|Brawl Stars">Brawl Stars</h3>
<p data-lang-text="–ì–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –ø—Ä–æ–∫–∞—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π|Gems, accounts, character boost">–ì–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –ø—Ä–æ–∫–∞—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 100‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Brawl Stars', 100)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-cod" data-price="280">
<div>
<div class="game-icon">üéñÔ∏è</div>
<h3 data-lang-text="Call of Duty|Call of Duty">Call of Duty</h3>
<p data-lang-text="COD Points, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –±–∞—Ç–ª-–ø–∞—Å—Å|COD Points, weapon skins, battle pass">COD Points, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –±–∞—Ç–ª-–ø–∞—Å—Å</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 280‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Call of Duty', 280)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-clash" data-price="130">
<div>
<div class="game-icon">‚öîÔ∏è</div>
<h3 data-lang-text="Clash of Clans|Clash of Clans">Clash of Clans</h3>
<p data-lang-text="–ì–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –ø—Ä–æ–∫–∞—á–∫–∞|Gems, accounts, boosting">–ì–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –ø—Ä–æ–∫–∞—á–∫–∞</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 130‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Clash of Clans', 130)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-clashroyale" data-price="140">
<div>
<div class="game-icon">üëë</div>
<h3 data-lang-text="Clash Royale|Clash Royale">Clash Royale</h3>
<p data-lang-text="–ì–µ–º—ã, –∫–∞—Ä—Ç—ã, —Å—É–Ω–¥—É–∫–∏|Gems, cards, chests">–ì–µ–º—ã, –∫–∞—Ä—Ç—ã, —Å—É–Ω–¥—É–∫–∏</p>
</div>
<div>
<div class="game-price">
<span class="price-display">140‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Clash Royale', 140)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-csgo" data-price="200">
<div>
<div class="game-icon">üî´</div>
<h3 data-lang-text="CS:GO|CS:GO">CS:GO</h3>
<p data-lang-text="–°–∫–∏–Ω—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –±—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞|Skins, accounts, rank boost">–°–∫–∏–Ω—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –±—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 200‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('CS:GO', 200)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-dota" data-price="220">
<div>
<div class="game-icon">‚öîÔ∏è</div>
<h3 data-lang-text="Dota 2|Dota 2">Dota 2</h3>
<p data-lang-text="–ê—Ä–∫–∞–Ω, –±–∞—Ç–ª-–ø–∞—Å—Å, –∫–æ—Å–º–µ—Ç–∏–∫–∞|Arcanas, battle pass, cosmetics">–ê—Ä–∫–∞–Ω, –±–∞—Ç–ª-–ø–∞—Å—Å, –∫–æ—Å–º–µ—Ç–∏–∫–∞</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 220‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Dota 2', 220)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-fallguys" data-price="90">
<div>
<div class="game-icon">ü§∏</div>
<h3 data-lang-text="Fall Guys|Fall Guys">Fall Guys</h3>
<p data-lang-text="Show-Bucks, –∫–æ—Å—Ç—é–º—ã, —Ñ–µ–π–º-–ø–∞—Å—Å|Show-Bucks, costumes, fame pass">Show-Bucks, –∫–æ—Å—Ç—é–º—ã, —Ñ–µ–π–º-–ø–∞—Å—Å</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 90‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Fall Guys', 90)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-fortnite" data-price="250">
<div>
<div class="game-icon">üèÜ</div>
<h3 data-lang-text="Fortnite|Fortnite">Fortnite</h3>
<p data-lang-text="V-Bucks, –±–∞—Ç–ª-–ø–∞—Å—Å, —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–Ω—ã|V-Bucks, battle pass, exclusive skins">V-Bucks, –±–∞—Ç–ª-–ø–∞—Å—Å, —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–Ω—ã</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 250‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Fortnite', 250)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-genshin" data-price="100">
<div>
<div class="game-icon">‚ö°</div>
<h3 data-lang-text="Genshin Impact|Genshin Impact">Genshin Impact</h3>
<p data-lang-text="–ü—Ä–∏–º–æ–≥–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏|Primogems, character accounts">–ü—Ä–∏–º–æ–≥–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 100‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Genshin Impact', 100)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-lol" data-price="200">
<div>
<div class="game-icon">üèÜ</div>
<h3 data-lang-text="League of Legends|League of Legends">League of Legends</h3>
<p data-lang-text="RP, —Å–∫–∏–Ω—ã, –±—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞|RP, skins, rank boosting">RP, —Å–∫–∏–Ω—ã, –±—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 200‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('League of Legends', 200)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-minecraft" data-price="50">
<div>
<div class="game-icon">‚öîÔ∏è</div>
<h3 data-lang-text="Minecraft|Minecraft">Minecraft</h3>
<p data-lang-text="–ê–∫–∫–∞—É–Ω—Ç—ã, –¥–æ–Ω–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏|Accounts, server donations, perks">–ê–∫–∫–∞—É–Ω—Ç—ã, –¥–æ–Ω–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 50‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Minecraft', 50)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-overwatch" data-price="150">
<div>
<div class="game-icon">üéÆ</div>
<h3 data-lang-text="Overwatch 2|Overwatch 2">Overwatch 2</h3>
<p data-lang-text="–ú–æ–Ω–µ—Ç—ã, —Å–∫–∏–Ω—ã, –ø—Ä–µ–º–∏—É–º|Coins, skins, premium">–ú–æ–Ω–µ—Ç—ã, —Å–∫–∏–Ω—ã, –ø—Ä–µ–º–∏—É–º</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 150‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Overwatch 2', 150)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-pubg" data-price="160">
<div>
<div class="game-icon">üéØ</div>
<h3 data-lang-text="PUBG|PUBG">PUBG</h3>
<p data-lang-text="UC, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–∞—Å—Å|UC, weapon skins, royale pass">UC, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–∞—Å—Å</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 160‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('PUBG', 160)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-r6" data-price="240">
<div>
<div class="game-icon">‚ö°</div>
<h3 data-lang-text="Rainbow Six Siege|Rainbow Six Siege">Rainbow Six Siege</h3>
<p data-lang-text="R6 Credits, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, –∫–æ—Å–º–µ—Ç–∏–∫–∞|R6 Credits, operators, cosmetics">R6 Credits, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, –∫–æ—Å–º–µ—Ç–∏–∫–∞</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 240‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Rainbow Six Siege', 240)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-roblox" data-price="150">
<div>
<div class="game-icon">üéÆ</div>
<h3 data-lang-text="Roblox|Roblox">Roblox</h3>
<p data-lang-text="Robux, –∏–≥—Ä–æ–≤—ã–µ –≤–∞–ª—é—Ç—ã, –ø—Ä–µ–º–∏—É–º|Robux, game currency, premium">Robux, –∏–≥—Ä–æ–≤—ã–µ –≤–∞–ª—é—Ç—ã, –ø—Ä–µ–º–∏—É–º</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 150‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Roblox', 150)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-rocket" data-price="120">
<div>
<div class="game-icon">üöó</div>
<h3 data-lang-text="Rocket League|Rocket League">Rocket League</h3>
<p data-lang-text="Credits, –º–∞—à–∏–Ω—ã, –¥–µ–∫–∞–ª–∏, —Ä–∞–∫–µ—Ç–Ω—ã–π –ø–∞—Å—Å|Credits, cars, decals, rocket pass">Credits, –º–∞—à–∏–Ω—ã, –¥–µ–∫–∞–ª–∏, —Ä–∞–∫–µ—Ç–Ω—ã–π –ø–∞—Å—Å</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 120‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Rocket League', 120)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-steam" data-price="100">
<div>
<div class="game-icon">üéÆ</div>
<h3 data-lang-text="Steam|Steam">Steam</h3>
<p data-lang-text="–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞, –∏–≥—Ä—ã, –ø–æ–¥–∞—Ä–∫–∏|Wallet top-up, games, gifts">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞, –∏–≥—Ä—ã, –ø–æ–¥–∞—Ä–∫–∏</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 100‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Steam', 100)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-telegram" data-price="80">
<div>
<div class="game-icon">‚≠ê</div>
<h3 data-lang-text="Telegram Stars|Telegram Stars">Telegram Stars</h3>
<p data-lang-text="–ó–≤–µ–∑–¥—ã –¥–ª—è –¥–æ–Ω–∞—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫|Stars for donations and subscriptions">–ó–≤–µ–∑–¥—ã –¥–ª—è –¥–æ–Ω–∞—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 80‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Telegram Stars', 80)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-valorant" data-price="300">
<div>
<div class="game-icon">üéØ</div>
<h3 data-lang-text="Valorant|Valorant">Valorant</h3>
<p data-lang-text="VP –æ—á–∫–∏, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –ø—Ä–æ–∫–∞—á–∫–∞|VP points, weapon skins, boosting">VP –æ—á–∫–∏, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –ø—Ä–æ–∫–∞—á–∫–∞</p>
</div>
<div>
<div class="game-price">
<span class="price-display">–û–¢ 300‚ÇΩ</span>
</div>
<button class="btn" onclick="buyProduct('Valorant', 300)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

</div>
</div>

<div class="container">
<div class="footer" id="contact">
<h3 data-lang-text="–°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π|Contact Me">–°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π</h3>
<p data-lang-text="–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏ –≤ Telegram –∏–ª–∏ –Ω–∞ Email!|Questions? DM on Telegram or Email!">–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏ –≤ Telegram –∏–ª–∏ –Ω–∞ Email!</p>
<div class="contact">
<a href="https://t.me/lowv1rre" target="_blank">üì± @lowv1rre</a>
<a href="mailto:lowv1re1@gmail.com">üìß lowv1re1@gmail.com</a>
</div>
<p style="margin-top:30px;color:var(--text-secondary);font-size:14px;">¬© 2024 LOWV1RE. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
</div>
</div>

<!-- –ú–û–î–ê–õ–ö–ê: –°–û–ó–î–ê–ù–ò–ï –¢–û–í–ê–†–ê -->
<div class="modal" id="createItemModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('createItemModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä|List Item">–í—ã—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
<div id="createItemError"></div>

<div class="form-group">
<label data-lang-text="–ò–≥—Ä–∞|Game">–ò–≥—Ä–∞</label>
<select id="itemGame" style="width:100%;padding:12px;background:var(--bg-secondary);border:2px solid var(--border-color);border-radius:10px;color:var(--text-primary);font-size:15px;">
<option value="" data-lang-text="–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É|Select game">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</option>
</select>
</div>

<div class="form-group">
<label data-lang-text="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞|Item Title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
<input type="text" id="itemTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–∫–∫–∞—É–Ω—Ç 30 –ª–≤–ª" maxlength="100" data-lang-placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–∫–∫–∞—É–Ω—Ç 30 –ª–≤–ª|For example: Account lvl 30">
</div>

<div class="form-group">
<label data-lang-text="–¶–µ–Ω–∞ (‚ÇΩ)|Price (‚ÇΩ)">–¶–µ–Ω–∞ (‚ÇΩ)</label>
<input type="number" id="itemPrice" placeholder="1000" min="1" step="1">
</div>

<div class="form-group">
<label data-lang-text="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞|Item Description">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
<textarea id="itemDescription" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä..." rows="6" style="width:100%;padding:12px;background:var(--bg-secondary);border:2px solid var(--border-color);border-radius:10px;color:var(--text-primary);font-size:15px;resize:vertical;" data-lang-placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä...|Describe your item in detail..."></textarea>
</div>

<button class="form-submit" id="createItemBtn" onclick="createItem()" data-lang-text="–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å|Publish">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</div>
</div>

<!-- –ú–û–î–ê–õ–ö–ê: –ö–ê–†–¢–û–ß–ö–ê –¢–û–í–ê–†–ê -->
<div class="modal" id="itemModal">
<div class="modal-content" style="max-width:700px;">
<span class="modal-close" onclick="closeModal('itemModal')">&times;</span>

<!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ -->
<div id="itemCard">
<!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
</div>
</div>

<div class="modal" id="loginModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('loginModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç|Login">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
<div id="loginError"></div>
<div class="form-group">
<label data-lang-text="Email –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º|Email or username">Email –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º</label>
<input type="text" id="loginEmail" placeholder="your@email.com –∏–ª–∏ username" autocomplete="off">
<div id="loginEmailError"></div>
</div>
<div class="form-group">
<label data-lang-text="–ü–∞—Ä–æ–ª—å|Password">–ü–∞—Ä–æ–ª—å</label>
<input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
</div>
<div class="cf-turnstile" data-sitekey="YOUR_CLOUDFLARE_SITE_KEY" data-callback="onLoginTurnstileSuccess"></div>
<button class="form-submit" onclick="login()" data-lang-text="–í–æ–π—Ç–∏|Login">–í–æ–π—Ç–∏</button>

<div class="divider" data-lang-text="–∏–ª–∏|or">–∏–ª–∏</div>

<button class="google-btn" onclick="loginWithGoogle()">
<svg class="google-icon" viewBox="0 0 24 24">
<path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
<path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
<path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
<path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
</svg>
<span data-lang-text="–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google|Sign in with Google">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</span>
</button>

<div class="form-switch">
<span data-lang-text="–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?|Don't have an account?">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span>
<a onclick="switchModal('loginModal', 'registerModal')" data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è|Register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
</div>
<div class="form-switch" style="margin-top:10px;">
<a onclick="switchModal('loginModal', 'forgotModal')" data-lang-text="–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å –∏–ª–∏ –∏–º—è?|Forgot password or username?">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å –∏–ª–∏ –∏–º—è?</a>
</div>
</div>
</div>

<div class="modal" id="registerModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('registerModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è|Registration">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
<div id="registerError"></div>
<div class="form-group">
<label data-lang-text="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è|Username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
<input type="text" id="registerUsername" placeholder="username" autocomplete="off" oninput="validateUsernameInput(this)">
<div id="usernameError"></div>
</div>
<div class="form-group">
<label data-lang-text="Email|Email">Email</label>
<input type="email" id="registerEmail" placeholder="your@email.com" autocomplete="off" oninput="validateEmailInput(this, 'emailError')">
<div id="emailError"></div>
</div>
<div class="form-group">
<label data-lang-text="–ü–∞—Ä–æ–ª—å|Password">–ü–∞—Ä–æ–ª—å</label>
<input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
</div>
<div class="cf-turnstile" data-sitekey="YOUR_CLOUDFLARE_SITE_KEY" data-callback="onRegisterTurnstileSuccess"></div>
<button class="form-submit" id="registerBtn" onclick="register()" data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>

<div class="divider" data-lang-text="–∏–ª–∏|or">–∏–ª–∏</div>

<button class="google-btn" onclick="registerWithGoogle()">
<svg class="google-icon" viewBox="0 0 24 24">
<path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
<path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
<path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
<path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
</svg>
<span data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google|Sign up with Google">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google</span>
</button>

<div class="form-switch">
<span data-lang-text="–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?|Already have an account?">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</span>
<a onclick="switchModal('registerModal', 'loginModal')" data-lang-text="–í–æ–π—Ç–∏|Login">–í–æ–π—Ç–∏</a>
</div>
</div>
</div>

<!-- Google Username Modal -->
<div class="modal" id="googleUsernameModal">
<div class="modal-content">
<h2 class="modal-title" data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è|Registration">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

<!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–∑–º–µ–Ω–µ–Ω–∏—è -->
<div style="position:relative;width:120px;margin:20px auto;">
    <div id="googleUsernameAvatar" style="width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);display:flex;align-items:center;justify-content:center;font-size:48px;color:white;overflow:hidden;position:relative;">
        <img id="googleAvatarImg" style="width:100%;height:100%;object-fit:cover;display:none;">
        <div id="googleAvatarLetter" style="font-size:48px;font-weight:bold;">U</div>
    </div>
    <label for="googleAvatarInput" style="position:absolute;bottom:0;right:0;background:#5ba3f5;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;border:3px solid var(--bg-primary);transition:all 0.2s;">
        <span style="font-size:18px;">üì∑</span>
    </label>
    <input type="file" id="googleAvatarInput" accept="image/*" style="display:none;" onchange="handleGoogleAvatarUpload(event)">
</div>

<div id="googleUsernameError"></div>
<p style="text-align:center;color:var(--text-secondary);margin-bottom:20px;" data-lang-text="–í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è|Choose your username">–í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
<div class="form-group">
<label data-lang-text="–õ–æ–≥–∏–Ω –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º|Username">–õ–æ–≥–∏–Ω –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º</label>
<input type="text" id="googleUsername" placeholder="username" maxlength="20" autocomplete="off" oninput="validateUsernameInput(this)">
<small style="color:var(--text-secondary);display:block;margin-top:5px;" data-lang-text="–õ–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã|Latin letters and numbers only">–õ–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã</small>
</div>
<button class="form-submit" onclick="completeGoogleRegistration()" data-lang-text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å|Save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>

<div class="modal" id="verifyEmailModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('verifyEmailModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏|Registration Confirmation">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
<div id="verifyError"></div>
<p style="text-align:center;color:#aaa;margin-bottom:20px;" data-lang-text="üéÉ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.|üéÉ Enter the code sent to your email to complete registration.">üéÉ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.</p>
<div class="form-group">
<label data-lang-text="–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (6 —Ü–∏—Ñ—Ä)|Verification code (6 digits)">–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (6 —Ü–∏—Ñ—Ä)</label>
<input type="text" id="verifyCode" placeholder="000000" maxlength="6" style="text-align:center;font-size:24px;letter-spacing:5px;">
</div>
<button class="form-submit" id="verifyBtn" onclick="verifyEmailCode()" data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
<div class="form-switch" style="margin-top:15px;">
<a onclick="resendVerificationCode()" data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ|Resend code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ</a>
</div>
</div>
</div>

<div class="modal" id="forgotModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('forgotModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è|Password Recovery">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h2>
<p style="color:var(--text-secondary);margin-bottom:24px;text-align:center;" data-lang-text="–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è|Enter email to receive recovery code">–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</p>
<div id="forgotError"></div>
<div class="form-group">
<label data-lang-text="–í–∞—à Email|Your Email">–í–∞—à Email</label>
<input type="email" id="forgotEmail" placeholder="your@email.com" autocomplete="off" oninput="validateEmailInput(this, 'forgotEmailError')">
<div id="forgotEmailError"></div>
</div>
<button class="form-submit" id="forgotBtn" onclick="sendRecovery()" data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥|Send code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
<div class="form-switch">
<a onclick="switchModal('forgotModal', 'loginModal')" data-lang-text="–ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É|Back to login">–ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É</a>
</div>
</div>
</div>

<div class="modal" id="resetModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('resetModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è|Password Reset">–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h2>
<div id="resetError"></div>
<p style="text-align:center;color:#aaa;margin-bottom:20px;" data-lang-text="üíÄ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å.|üíÄ Enter the code to reset your password.">üíÄ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å.</p>
<div class="form-group">
<label data-lang-text="–ö–æ–¥ –∏–∑ –ø–∏—Å—å–º–∞ (6 —Ü–∏—Ñ—Ä)|Code from email (6 digits)">–ö–æ–¥ –∏–∑ –ø–∏—Å—å–º–∞ (6 —Ü–∏—Ñ—Ä)</label>
<input type="text" id="resetCode" placeholder="000000" maxlength="6" style="text-align:center;font-size:24px;letter-spacing:5px;">
</div>
<button class="form-submit" id="resetBtn" onclick="verifyCode()" data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</button>
<div class="form-switch" style="margin-top:15px;">
<a onclick="resendCode()" data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ|Resend code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ</a>
</div>
</div>
</div>

<div class="modal" id="newPasswordModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('newPasswordModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å|New password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</h2>
<div id="newPasswordError"></div>
<div class="form-group">
<label data-lang-text="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å|New password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
<input type="password" id="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
</div>
<div class="form-group">
<label data-lang-text="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å|Repeat password">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
<input type="password" id="newPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
</div>
<button class="form-submit" id="newPasswordBtn" onclick="saveNewPassword()" data-lang-text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å|Save password">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
</div>
</div>

<script>
const SUPABASE_URL = 'https://nbelgmhtxjjlfpqmkqbl.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5iZWxnbWh0eGpqbGZwcW1rcWJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NDg2OTcsImV4cCI6MjA3NzQyNDY5N30.6snueQkGb7LorM_qhVNHdxUOC90FypoVzxllniwn70Q';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let currentUser = null;
let currentLang = 'ru';
let recoveryEmail = '';
let verifiedCode = '';
let pendingRegistration = null;
let currentCurrency = 'RUB';
let currentTheme = 'dark';
let loginTurnstileToken = null;
let registerTurnstileToken = null;
let pendingGoogleUser = null;
let pendingAvatarFile = null; // –§–∞–π–ª –∞–≤–∞—Ç–∞—Ä–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

// –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç (–ø—Ä–∏–º–µ—Ä–Ω—ã–µ)
const currencyRates = {
    RUB: 1,
    USD: 0.011,
    EUR: 0.010
};

const currencySymbols = {
    RUB: '‚ÇΩ',
    USD: '$',
    EUR: '‚Ç¨'
};

// –û—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ Edge Function
async function sendEmailCode(email, code, type = 'registration') {
    console.log('üìß [EMAIL] –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É email...');
    console.log('üìß [EMAIL] Email:', email);
    console.log('üìß [EMAIL] Code:', code);
    console.log('üìß [EMAIL] Type:', type);
    
    try {
        // –°–æ–∑–¥–∞—ë–º AbortController –¥–ª—è —Ç–∞–π–º–∞—É—Ç–∞
        const controller = new AbortController();
        const timeoutId = setTimeout(() => {
            console.log('‚è±Ô∏è [EMAIL] –¢–∞–π–º–∞—É—Ç! –û—Ç–º–µ–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å...');
            controller.abort();
        }, 10000); // 10 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
        
        console.log('üìß [EMAIL] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ Edge Function...');
        
        const response = await fetch('https://nbelgmhtxjjlfpqmkqbl.supabase.co/functions/v1/send-recovery-code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${SUPABASE_KEY}`
            },
            body: JSON.stringify({
                email: email,
                code: code
            }),
            signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        console.log('üìß [EMAIL] –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç! Status:', response.status);
        
        if (!response.ok) {
            const error = await response.json();
            console.error('‚ùå [EMAIL] Edge Function error:', error);
            return false;
        }
        
        const data = await response.json();
        console.log('‚úÖ [EMAIL] Email —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', data);
        return true;
        
    } catch (error) {
        if (error.name === 'AbortError') {
            console.error('‚è±Ô∏è [EMAIL] –ó–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω—ë–Ω –ø–æ —Ç–∞–π–º–∞—É—Ç—É (10 —Å–µ–∫)');
            console.log('‚ö†Ô∏è [EMAIL] Edge Function –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ email');
        } else {
            console.error('‚ùå [EMAIL] –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ Edge Function:', error);
        }
        return false;
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ (000001-999999)
function generateCode() {
    const code = Math.floor(Math.random() * 999999) + 1;
    return code.toString().padStart(6, '0');
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è email
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è username (—Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)
function isValidUsername(username) {
    const usernameRegex = /^[a-zA-Z0-9]+$/;
    return usernameRegex.test(username);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ username –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function validateUsernameInput(input) {
    const value = input.value;
    const errorDiv = document.getElementById('usernameError');
    
    if (value && !isValidUsername(value)) {
        input.style.borderColor = '#ff4444';
        input.style.boxShadow = '0 0 10px rgba(255, 68, 68, 0.5)';
        errorDiv.innerHTML = '<div class="error-msg" style="margin-top:5px;">Username –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã (a-z) –∏ —Ü–∏—Ñ—Ä—ã (0-9)</div>';
    } else {
        input.style.borderColor = 'rgba(255,140,0,0.4)';
        input.style.boxShadow = 'none';
        errorDiv.innerHTML = '';
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ email –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function validateEmailInput(input, errorDivId) {
    const value = input.value.trim();
    const errorDiv = document.getElementById(errorDivId);
    
    if (value && !isValidEmail(value)) {
        input.style.borderColor = '#ff4444';
        input.style.boxShadow = '0 0 10px rgba(255, 68, 68, 0.5)';
        if (!errorDiv.querySelector('.error-msg')) {
            errorDiv.innerHTML = '<div class="error-msg" style="margin-top:5px;">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email (–Ω–∞–ø—Ä–∏–º–µ—Ä: name@example.com)</div>';
        }
    } else {
        input.style.borderColor = 'rgba(255,140,0,0.4)';
        input.style.boxShadow = 'none';
        if (errorDiv.querySelector('.error-msg') && errorDiv.textContent.includes('email')) {
            errorDiv.innerHTML = '';
        }
    }
}

// –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
function clearForm(formId) {
    const inputs = document.querySelectorAll(`#${formId} input`);
    inputs.forEach(input => input.value = '');
}

// –û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
function clearMessages(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        element.innerHTML = '';
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —Å —É—á–µ—Ç–æ–º –≤–∞–ª—é—Ç—ã
function updateBalance() {
    if (!currentUser) return;
    const balance = currentUser.balance * currencyRates[currentCurrency];
    const symbol = currencySymbols[currentCurrency];
    const formattedBalance = currentCurrency === 'RUB' ? 
        `${Math.round(balance)}${symbol}` : 
        `${symbol}${balance.toFixed(2)}`;
    document.getElementById('profileBalance').textContent = formattedBalance;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã
function changeCurrency() {
    // –†–∞–±–æ—Ç–∞–µ—Ç –∏ —Å –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–º –∏ —Å –º–æ–±–∏–ª—å–Ω—ã–º select
    const desktopSelect = document.getElementById('currencySwitch');
    const mobileSelect = document.getElementById('currencySwitchMobile');
    
    if (mobileSelect && mobileSelect.value !== currentCurrency) {
        currentCurrency = mobileSelect.value;
        if (desktopSelect) desktopSelect.value = currentCurrency;
    } else if (desktopSelect) {
        currentCurrency = desktopSelect.value;
        if (mobileSelect) mobileSelect.value = currentCurrency;
    }
    
    localStorage.setItem('currency', currentCurrency);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤ –ø—Ä–æ—Ñ–∏–ª–µ
    updateBalance();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ü–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    updateAllPrices();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ü–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
function updateAllPrices() {
    const gameCards = document.querySelectorAll('.game-card[data-price]');
    const fromText = currentLang === 'ru' ? '–û–¢ ' : 'FROM ';
    
    gameCards.forEach(card => {
        const basePrice = parseInt(card.getAttribute('data-price'));
        const priceDisplay = card.querySelector('.price-display');
        
        if (priceDisplay && basePrice) {
            const convertedPrice = basePrice * currencyRates[currentCurrency];
            const symbol = currencySymbols[currentCurrency];
            
            const priceText = currentCurrency === 'RUB' ? 
                `${Math.round(convertedPrice)}${symbol}` : 
                `${symbol}${convertedPrice.toFixed(1)}`;
            
            priceDisplay.textContent = fromText + priceText;
        }
    });
}

// –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    const overlay = document.getElementById('mobileMenuOverlay');
    menu.classList.toggle('active');
    overlay.classList.toggle('active');
    document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
}

function closeMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    const overlay = document.getElementById('mobileMenuOverlay');
    menu.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
}

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å desktop
function syncMobileControls() {
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã
    const currencyMobile = document.getElementById('currencySwitchMobile');
    if (currencyMobile) {
        currencyMobile.value = currentCurrency;
    }
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
    const themeMobile = document.getElementById('themeToggleMobile');
    if (themeMobile) {
        themeMobile.textContent = currentTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞
    const langMobile = document.getElementById('langSwitchMobile');
    if (langMobile) {
        langMobile.textContent = currentLang.toUpperCase();
    }
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è authSection
    const authMobile = document.getElementById('authSectionMobile');
    const authDesktop = document.getElementById('authSection');
    if (authMobile && authDesktop) {
        authMobile.innerHTML = authDesktop.innerHTML;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
function toggleTheme() {
    currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.body.classList.toggle('light-theme');
    localStorage.setItem('theme', currentTheme);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö
    const themeIcon = document.getElementById('themeToggle');
    const themeIconMobile = document.getElementById('themeToggleMobile');
    const icon = currentTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    if (themeIcon) themeIcon.textContent = icon;
    if (themeIconMobile) themeIconMobile.textContent = icon;
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏–≥—Ä
function searchGames() {
    const searchInput = document.getElementById('gameSearchInput');
    const searchTerm = searchInput.value.toLowerCase().trim();
    const gameCards = document.querySelectorAll('.game-card');
    let visibleCount = 0;
    
    gameCards.forEach(card => {
        const gameName = card.querySelector('h3').textContent.toLowerCase();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å –ù–ê–ß–ê–õ–ê –Ω–∞–∑–≤–∞–Ω–∏—è
        if (searchTerm === '' || gameName.startsWith(searchTerm)) {
            card.style.display = 'flex';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    let noResultsMsg = document.getElementById('noResultsMessage');
    
    if (visibleCount === 0 && searchTerm !== '') {
        if (!noResultsMsg) {
            noResultsMsg = document.createElement('div');
            noResultsMsg.id = 'noResultsMessage';
            noResultsMsg.className = 'no-results';
            noResultsMsg.innerHTML = `
                <div class="no-results-icon">üò¢</div>
                <div data-lang-text="–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.|No games found. Try another search.">
                    –ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.
                </div>
            `;
            document.getElementById('gamesGrid').parentElement.appendChild(noResultsMsg);
        }
        noResultsMsg.style.display = 'block';
    } else {
        if (noResultsMsg) {
            noResultsMsg.style.display = 'none';
        }
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
// –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ IP –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã –∏ —è–∑—ã–∫–∞
async function detectLocationAndSetDefaults() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const savedCurrency = localStorage.getItem('currency');
    const savedLang = localStorage.getItem('language');
    
    // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ –µ—Å—Ç—å, –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º
    if (savedCurrency && savedLang) {
        return;
    }
    
    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã –ø–æ IP
        const response = await fetch('https://ipapi.co/json/', {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (!response.ok) {
            console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
            return;
        }
        
        const data = await response.json();
        const countryCode = data.country_code;
        
        console.log('üåç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∞:', countryCode, data.country_name);
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞–ª—é—Ç—É –∏ —è–∑—ã–∫ –ø–æ —Å—Ç—Ä–∞–Ω–µ
        let detectedCurrency = 'RUB';
        let detectedLang = 'ru';
        
        // –ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω—ã (EUR + EN)
        const eurCountries = ['AT', 'BE', 'CY', 'EE', 'FI', 'FR', 'DE', 'GR', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PT', 'SK', 'SI', 'ES'];
        
        // –ê–Ω–≥–ª–æ—è–∑—ã—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã (USD + EN)
        const usdCountries = ['US', 'CA', 'GB', 'AU', 'NZ', 'SG', 'HK'];
        
        // –°–ù–ì —Å—Ç—Ä–∞–Ω—ã (RUB + RU)
        const rubCountries = ['RU', 'BY', 'KZ', 'KG', 'TJ', 'UZ', 'TM', 'AM', 'AZ', 'MD'];
        
        if (eurCountries.includes(countryCode)) {
            detectedCurrency = 'EUR';
            detectedLang = 'en';
            console.log('üá™üá∫ –ï–≤—Ä–æ–ø–∞ ‚Üí EUR + EN');
        } else if (usdCountries.includes(countryCode)) {
            detectedCurrency = 'USD';
            detectedLang = 'en';
            console.log('üá∫üá∏ –ê–Ω–≥–ª–æ—è–∑—ã—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞ ‚Üí USD + EN');
        } else if (rubCountries.includes(countryCode)) {
            detectedCurrency = 'RUB';
            detectedLang = 'ru';
            console.log('üá∑üá∫ –°–ù–ì ‚Üí RUB + RU');
        } else {
            // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            detectedCurrency = 'USD';
            detectedLang = 'en';
            console.log('üåé –î—Ä—É–≥–∞—è —Å—Ç—Ä–∞–Ω–∞ ‚Üí USD + EN (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)');
        }
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç
        if (!savedCurrency) {
            currentCurrency = detectedCurrency;
            document.getElementById('currencySwitch').value = detectedCurrency;
            localStorage.setItem('currency', detectedCurrency);
        }
        
        if (!savedLang) {
            currentLang = detectedLang;
            document.getElementById('langSwitch').textContent = detectedLang.toUpperCase();
            localStorage.setItem('language', detectedLang);
        }
        
        console.log('‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', detectedCurrency, detectedLang.toUpperCase());
        
    } catch (error) {
        console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error.message);
        console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: RUB + RU');
    }
}

function loadSettings() {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞–ª—é—Ç—ã
    const savedCurrency = localStorage.getItem('currency');
    if (savedCurrency) {
        currentCurrency = savedCurrency;
        document.getElementById('currencySwitch').value = savedCurrency;
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
        currentTheme = savedTheme;
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã
    updateAllPrices();
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    setTimeout(() => syncMobileControls(), 100);
}

window.addEventListener('load', async () => {
    // –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é
    await detectLocationAndSetDefaults();
    
    // –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–Ω–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é)
    loadSettings();
    await checkAuth();
    
    // –°–ª—É—à–∞–µ–º auth state –¥–ª—è Google OAuth
    supabase.auth.onAuthStateChange(async (event, session) => {
        if (event === 'SIGNED_IN' && session) {
            await checkAuth();
        }
    });
    
    updateLangText();
    syncMobileControls();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.getElementById('currencySwitch').addEventListener('change', changeCurrency);
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
});

async function checkAuth() {
    const { data: { user } } = await supabase.auth.getUser();
    if (user) {
        const { data: userData } = await supabase.from('users').select('*').eq('email', user.email).maybeSingle();
        if (userData) {
            currentUser = userData;
            showUserProfile();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–∞—Ç –µ—Å–ª–∏ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç
            try {
                const savedChatId = sessionStorage.getItem('currentChatId');
                if (savedChatId) {
                    console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–∞—Ç:', savedChatId);
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
                    setTimeout(() => {
                        openChat(parseInt(savedChatId));
                    }, 500);
                }
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–∞—Ç:', e);
            }
        } else if (user.app_metadata.provider === 'google') {
            // Google –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤—ã–±–æ—Ä–∞ username
            pendingGoogleUser = user;
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –∏–∑ Google (–µ—Å–ª–∏ –µ—Å—Ç—å)
            const googleAvatar = user.user_metadata?.avatar_url || user.user_metadata?.picture;
            const avatarLetter = user.email.charAt(0).toUpperCase();
            
            const imgEl = document.getElementById('googleAvatarImg');
            const letterEl = document.getElementById('googleAvatarLetter');
            
            if (googleAvatar) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –∏–∑ Google
                imgEl.src = googleAvatar;
                imgEl.style.display = 'block';
                letterEl.style.display = 'none';
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—É–∫–≤—É
                letterEl.textContent = avatarLetter;
                letterEl.style.display = 'block';
                imgEl.style.display = 'none';
            }
            
            document.getElementById('googleUsername').value = user.email.split('@')[0];
            openModal('googleUsernameModal');
            console.log('üë§ –ù–æ–≤—ã–π Google –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–±–æ—Ä username');
        }
    } else {
        showAuthButton();
    }
}

function showAuthButton() {
    // –û—á–∏—â–∞–µ–º authSection - –∫–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.getElementById('authSection').innerHTML = '';
    document.getElementById('profileSection').style.display = 'none';
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ –≤ hero —Å–µ–∫—Ü–∏–∏
    const heroButtons = document.getElementById('heroButtons');
    if (heroButtons) heroButtons.style.display = 'flex';
    updateLangText();
    syncMobileControls();
}

function showUserProfile() {
    const avatar = currentUser.username.charAt(0).toUpperCase();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –≤ —Ö–µ–¥–µ—Ä–µ
    if (currentUser.avatar_url) {
        document.getElementById('authSection').innerHTML = `
            <div class="user-info" onclick="toggleProfile()">
                <div class="user-avatar" style="background-image:url(${currentUser.avatar_url});background-size:cover;background-position:center;"></div>
                <div class="user-name">${currentUser.username}</div>
            </div>`;
    } else {
        document.getElementById('authSection').innerHTML = `
            <div class="user-info" onclick="toggleProfile()">
                <div class="user-avatar">${avatar}</div>
                <div class="user-name">${currentUser.username}</div>
            </div>`;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ
    updateProfileAvatar();
    
    document.getElementById('profileUsername').textContent = currentUser.username;
    document.getElementById('profileEmail').textContent = currentUser.email;
    document.getElementById('profileUrl').textContent = `lowv1re.eu/profile/${currentUser.username}`;
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–π –≤–∞–ª—é—Ç—ã
    updateBalance();
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
    updateProfileItemsCount();
    // –û–±–Ω–æ–≤–ª—è–µ–º badge –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    updateUnreadBadge();
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ –≤ hero —Å–µ–∫—Ü–∏–∏
    const heroButtons = document.getElementById('heroButtons');
    if (heroButtons) heroButtons.style.display = 'none';
    const date = new Date(currentUser.created_at);
    document.getElementById('profileDate').textContent = date.toLocaleDateString('ru-RU');
    syncMobileControls();
}

function toggleProfile() {
    const profile = document.getElementById('profileSection');
    const games = document.getElementById('games');
    if (profile.style.display === 'none') {
        profile.style.display = 'block';
        games.style.display = 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    } else {
        profile.style.display = 'none';
        games.style.display = 'block';
    }
}

async function register() {
    const username = document.getElementById('registerUsername').value.trim();
    const email = document.getElementById('registerEmail').value.trim().toLowerCase();
    const password = document.getElementById('registerPassword').value;
    const errorDiv = document.getElementById('registerError');
    const btn = document.getElementById('registerBtn');
    
    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    errorDiv.innerHTML = '';
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π
    if (!username || !email || !password) {
        errorDiv.innerHTML = '<div class="error-msg">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!</div>';
        return;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è username
    if (!isValidUsername(username)) {
        errorDiv.innerHTML = '<div class="error-msg">Username –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã (a-z) –∏ —Ü–∏—Ñ—Ä—ã (0-9)</div>';
        return;
    }
    
    if (username.length < 3) {
        errorDiv.innerHTML = '<div class="error-msg">Username –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞</div>';
        return;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è email
    if (!isValidEmail(email)) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email!</div>';
        return;
    }
    
    if (password.length < 6) {
        errorDiv.innerHTML = '<div class="error-msg">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!</div>';
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ Turnstile (–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ)
    // if (!registerTurnstileToken) {
    //     errorDiv.innerHTML = '<div class="error-msg">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —á—Ç–æ –≤—ã –Ω–µ —Ä–æ–±–æ—Ç!</div>';
    //     return;
    // }
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞...|Sending code...">–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞...</span>';
    
    try {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è username
        const { data: existingUser } = await supabase
            .from('users')
            .select('username')
            .eq('username', username)
            .maybeSingle();
        
        if (existingUser) {
            errorDiv.innerHTML = '<div class="error-msg">–≠—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>';
            updateLangText();
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email
        const { data: existingEmail } = await supabase
            .from('users')
            .select('email')
            .eq('email', email)
            .maybeSingle();
        
        if (existingEmail) {
            errorDiv.innerHTML = '<div class="error-msg">–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>';
            updateLangText();
            return;
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
        const code = generateCode();
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–¥—ã –¥–ª—è —ç—Ç–æ–≥–æ email
        await supabase.from('recovery_codes').delete().eq('email', email);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ –ë–î (–∏—Å–ø–æ–ª—å–∑—É–µ–º timestamp –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è timezone –ø—Ä–æ–±–ª–µ–º)
        const now = Date.now(); // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        const expiresAt = new Date(now + 10 * 60 * 1000); // +10 –º–∏–Ω—É—Ç
        
        console.log('‚è∞ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–¥–∞:');
        console.log('   Timestamp —Å–µ–π—á–∞—Å:', now);
        console.log('   –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (UTC):', new Date(now).toISOString());
        console.log('   –ò—Å—Ç–µ–∫–∞–µ—Ç (UTC/ISO):', expiresAt.toISOString());
        console.log('   –†–∞–∑–Ω–∏—Ü–∞: +10 –º–∏–Ω—É—Ç');
        
        const { error: codeError } = await supabase.from('recovery_codes').insert([{
            email: email,
            code: code,
            expires_at: expiresAt.toISOString(),
            used: false
        }]);
        
        if (codeError) throw codeError;
        
        // –í—Ä–µ–º–µ–Ω–Ω–æ: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–¥–ª—è —Ç–µ—Å—Ç–∞)
        console.log('===================');
        console.log('–ö–û–î –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò:', code);
        console.log('EMAIL:', email);
        console.log('===================');
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Resend API –Ω–∞–ø—Ä—è–º—É—é
        const emailSent = await sendEmailCode(email, code, 'registration');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        pendingRegistration = { username, email, password };
        registerTurnstileToken = null; // –°–±—Ä–æ—Å —Ç–æ–∫–µ–Ω–∞
        
        // –°—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –º–æ–¥–∞–ª–∫—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞ (–ë–ï–ó –∑–∞–¥–µ—Ä–∂–∫–∏!)
        closeModal('registerModal');
        openModal('verifyEmailModal');
        document.getElementById('verifyCode').focus();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –£–ñ–ï –≤ –Ω–æ–≤–æ–π –º–æ–¥–∞–ª–∫–µ
        const verifyErrorDiv = document.getElementById('verifyError');
        if (emailSent) {
            verifyErrorDiv.innerHTML = '<div class="success-msg">‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É!</div>';
        } else {
            verifyErrorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –ø—Ä–∏—à—ë–ª - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)</div>';
        }
        
    } catch (error) {
        console.error('Registration error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>';
        updateLangText();
    }
}

async function verifyEmailCode() {
    const code = document.getElementById('verifyCode').value.trim();
    const errorDiv = document.getElementById('verifyError');
    const btn = document.getElementById('verifyBtn');
    
    errorDiv.innerHTML = '';
    
    if (!code || code.length !== 6) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥!</div>';
        return;
    }
    
    if (!pendingRegistration) {
        errorDiv.innerHTML = '<div class="error-msg">–û—à–∏–±–∫–∞! –ù–∞—á–Ω–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ.</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∫–∞...|Verifying...">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>';
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥
        const { data: codeData, error } = await supabase
            .from('recovery_codes')
            .select('*')
            .eq('email', pendingRegistration.email)
            .eq('code', code)
            .eq('used', false)
            .maybeSingle();
        
        if (error || !codeData) {
            errorDiv.innerHTML = '<div class="error-msg">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>';
            updateLangText();
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ–º UTC timestamp –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
        const expiresAt = new Date(codeData.expires_at);
        const now = new Date();
        
        console.log('‚è∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:');
        console.log('   –°–µ–π—á–∞—Å:', now.toISOString());
        console.log('   –ò—Å—Ç–µ–∫–∞–µ—Ç:', expiresAt.toISOString());
        console.log('   –†–∞–∑–Ω–∏—Ü–∞ (–º–∏–Ω—É—Ç):', (expiresAt - now) / 60000);
        
        if (now.getTime() > expiresAt.getTime()) {
            errorDiv.innerHTML = '<div class="error-msg">–ö–æ–¥ –∏—Å—Ç—ë–∫! –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥.</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>';
            updateLangText();
            return;
        }
        
        errorDiv.innerHTML = '<div class="success-msg">Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω! –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞...</div>';
        
        // –û—Ç–º–µ—á–∞–µ–º –∫–æ–¥ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
        await supabase.from('recovery_codes').update({ used: true }).eq('code', code);
        
        // –°–æ–∑–¥–∞—ë–º –∞–∫–∫–∞—É–Ω—Ç –≤ Supabase Auth
        const { data: authData, error: authError } = await supabase.auth.signUp({
            email: pendingRegistration.email,
            password: pendingRegistration.password,
            options: { emailRedirectTo: window.location.origin }
        });
        
        if (authError) throw authError;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É users
        const { error: dbError } = await supabase.from('users').insert([{
            username: pendingRegistration.username,
            email: pendingRegistration.email,
            is_admin: false,
            balance: 0
        }]);
        
        if (dbError) throw dbError;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç
        const { data: loginData, error: loginError } = await supabase.auth.signInWithPassword({
            email: pendingRegistration.email,
            password: pendingRegistration.password
        });
        
        if (loginError) throw loginError;
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const { data: finalUserData } = await supabase
            .from('users')
            .select('*')
            .eq('email', pendingRegistration.email)
            .single();
        
        currentUser = finalUserData;
        
        errorDiv.innerHTML = '<div class="success-msg">‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>';
        
        setTimeout(() => {
            closeModal('verifyEmailModal');
            showUserProfile();
            pendingRegistration = null;
        }, 1500);
        
    } catch (error) {
        console.error('Verification error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>';
        updateLangText();
    }
}

async function resendVerificationCode() {
    if (!pendingRegistration) {
        alert('–û—à–∏–±–∫–∞! –ù–∞—á–Ω–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ.');
        return;
    }
    
    const errorDiv = document.getElementById('verifyError');
    errorDiv.innerHTML = '<div class="success-msg">–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞...</div>';
    
    const code = generateCode();
    
    try {
        await supabase.from('recovery_codes').delete().eq('email', pendingRegistration.email);
        
        const expiresAt = new Date(Date.now() + 10 * 60 * 1000);
        
        await supabase.from('recovery_codes').insert([{
            email: pendingRegistration.email,
            code: code,
            expires_at: expiresAt.toISOString(),
            used: false
        }]);
        
        console.log('===================');
        console.log('–ù–û–í–´–ô –ö–û–î:', code);
        console.log('EMAIL:', pendingRegistration.email);
        console.log('===================');
        
        const emailSent = await sendEmailCode(pendingRegistration.email, code, 'registration');
        
        if (emailSent) {
            errorDiv.innerHTML = '<div class="success-msg">‚úÖ –ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ—á—Ç—É!</div>';
        } else {
            errorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ù–æ–≤—ã–π –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12)!</div>';
        }
        
        document.getElementById('verifyCode').value = '';
        document.getElementById('verifyCode').focus();
    } catch (error) {
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    }
}

// Google Auth
async function loginWithGoogle() {
    try {
        const { data, error } = await supabase.auth.signInWithOAuth({
            provider: 'google',
            options: {
                redirectTo: 'https://lowv1re.eu'
            }
        });
        
        if (error) throw error;
        
        console.log('üîê Google Auth initiated');
        
    } catch (error) {
        console.error('Google Auth Error:', error);
        const errorDiv = document.getElementById('loginError');
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google: ${error.message}</div>`;
    }
}

async function registerWithGoogle() {
    try {
        const { data, error } = await supabase.auth.signInWithOAuth({
            provider: 'google',
            options: {
                redirectTo: 'https://lowv1re.eu'
            }
        });
        
        if (error) throw error;
        
        console.log('üîê Google Registration initiated');
        
    } catch (error) {
        console.error('Google Auth Error:', error);
        const errorDiv = document.getElementById('registerError');
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google: ${error.message}</div>`;
    }
}

async function completeGoogleRegistration() {
    console.log('üîµ [SAVE] –ö–Ω–æ–ø–∫–∞ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∂–∞—Ç–∞');
    
    const username = document.getElementById('googleUsername').value.trim();
    const errorDiv = document.getElementById('googleUsernameError');
    
    console.log('üîµ [SAVE] Username:', username);
    
    errorDiv.innerHTML = '';
    
    if (!username) {
        console.log('‚ùå [SAVE] Username –ø—É—Å—Ç–æ–π');
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!</div>';
        return;
    }
    
    if (!isValidUsername(username)) {
        console.log('‚ùå [SAVE] Username –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π');
        errorDiv.innerHTML = '<div class="error-msg">Username –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã (a-z) –∏ —Ü–∏—Ñ—Ä—ã (0-9)</div>';
        return;
    }
    
    if (username.length < 4 || username.length > 16) {
        console.log('‚ùå [SAVE] Username –¥–ª–∏–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è:', username.length);
        errorDiv.innerHTML = '<div class="error-msg">Username –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 4 –¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤</div>';
        return;
    }
    
    console.log('üîµ [SAVE] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ë–î...');
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–Ω—è—Ç –ª–∏ username
        const { data: existingUser, error: checkError } = await supabase
            .from('users')
            .select('username')
            .eq('username', username)
            .maybeSingle();
        
        console.log('üîµ [SAVE] –ü—Ä–æ–≤–µ—Ä–∫–∞ username:', existingUser ? '–ó–ê–ù–Ø–¢' : '–°–í–û–ë–û–î–ï–ù');
        
        if (existingUser) {
            console.log('‚ùå [SAVE] Username —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
            errorDiv.innerHTML = '<div class="error-msg">–≠—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!</div>';
            return;
        }
        
        console.log('üîµ [SAVE] –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î...');
        console.log('üîµ [SAVE] Email:', pendingGoogleUser?.email);
        
        // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–ï–ó –∞–≤–∞—Ç–∞—Ä–∫–∏
        const { data: newUser, error } = await supabase
            .from('users')
            .insert([{
                username: username,
                email: pendingGoogleUser.email,
                is_admin: false,
                balance: 0,
                avatar_url: null // –ü–æ–∫–∞ –±–µ–∑ –∞–≤–∞—Ç–∞—Ä–∫–∏
            }])
            .select()
            .single();
        
        console.log('üîµ [SAVE] –†–µ–∑—É–ª—å—Ç–∞—Ç INSERT:', { newUser, error });
        
        if (error) {
            console.log('‚ùå [SAVE] –û—à–∏–±–∫–∞ –ø—Ä–∏ INSERT:', error);
            throw error;
        }
        
        console.log('‚úÖ [SAVE] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ –ë–î!');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –µ—Å–ª–∏ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞
        if (pendingAvatarFile) {
            console.log('üì§ [SAVE] –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É...');
            try {
                const avatarUrl = await uploadAvatarToStorage(pendingAvatarFile, newUser.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–≤–∞—Ç–∞—Ä–∫–æ–π
                const { error: updateError } = await supabase
                    .from('users')
                    .update({ avatar_url: avatarUrl })
                    .eq('id', newUser.id);
                
                if (updateError) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è avatar_url:', updateError);
                } else {
                    newUser.avatar_url = avatarUrl;
                    console.log('‚úÖ [SAVE] –ê–≤–∞—Ç–∞—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                }
            } catch (avatarError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏:', avatarError);
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∞–∂–µ –µ—Å–ª–∏ –∞–≤–∞—Ç–∞—Ä–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
            }
            
            // –û—á–∏—â–∞–µ–º pendingAvatarFile
            pendingAvatarFile = null;
        }
        
        currentUser = newUser;
        console.log('üîµ [SAVE] –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É...');
        closeModal('googleUsernameModal');
        console.log('üîµ [SAVE] –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å...');
        showUserProfile();
        console.log('‚úÖ [SAVE] –ì–û–¢–û–í–û! Username:', username);
        
    } catch (error) {
        console.error('‚ùå [SAVE] –û–®–ò–ë–ö–ê:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    }
}

// === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ê–í–ê–¢–ê–†–ö–ê–ú–ò ===

// –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ –≤ Storage
async function uploadAvatarToStorage(file, userId) {
    try {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
        const fileExt = file.name.split('.').pop();
        const fileName = `${userId}-${Date.now()}.${fileExt}`;
        const filePath = `${fileName}`;
        
        console.log('üì§ –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É:', filePath);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –≤ Storage
        const { data, error } = await supabase.storage
            .from('avatars')
            .upload(filePath, file, {
                cacheControl: '3600',
                upsert: true
            });
        
        if (error) throw error;
        
        // –ü–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π URL
        const { data: urlData } = supabase.storage
            .from('avatars')
            .getPublicUrl(filePath);
        
        console.log('‚úÖ –ê–≤–∞—Ç–∞—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', urlData.publicUrl);
        return urlData.publicUrl;
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏:', error);
        throw error;
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –≤ –º–æ–¥–∞–ª–∫–µ Google
function handleGoogleAvatarUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('üì∑ –í—ã–±—Ä–∞–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∞:', file.name);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å 5MB)
    if (file.size > 5 * 1024 * 1024) {
        alert(currentLang === 'ru' ? '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB.' : 'File too large! Maximum 5MB.');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
    if (!file.type.startsWith('image/')) {
        alert(currentLang === 'ru' ? '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!' : 'Please select an image!');
        return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    pendingAvatarFile = file;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
    const reader = new FileReader();
    reader.onload = (e) => {
        const imgEl = document.getElementById('googleAvatarImg');
        const letterEl = document.getElementById('googleAvatarLetter');
        
        imgEl.src = e.target.result;
        imgEl.style.display = 'block';
        letterEl.style.display = 'none';
        
        console.log('‚úÖ –ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–∫–∞–∑–∞–Ω–æ');
    };
    reader.readAsDataURL(file);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
async function handleProfileAvatarUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('üì∑ –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é –∞–≤–∞—Ç–∞—Ä–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å 5MB)
    if (file.size > 5 * 1024 * 1024) {
        alert(currentLang === 'ru' ? '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB.' : 'File too large! Maximum 5MB.');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
    if (!file.type.startsWith('image/')) {
        alert(currentLang === 'ru' ? '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!' : 'Please select an image!');
        return;
    }
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –≤ Storage
        const avatarUrl = await uploadAvatarToStorage(file, currentUser.id);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ë–î
        const { error } = await supabase
            .from('users')
            .update({ avatar_url: avatarUrl })
            .eq('id', currentUser.id);
        
        if (error) throw error;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
        currentUser.avatar_url = avatarUrl;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        updateProfileAvatar();
        
        console.log('‚úÖ –ê–≤–∞—Ç–∞—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏:', error);
        alert(currentLang === 'ru' ? '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏!' : 'Error updating avatar!');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
function updateProfileAvatar() {
    const avatarEl = document.getElementById('profileAvatar');
    
    if (currentUser.avatar_url) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É
        avatarEl.style.backgroundImage = `url(${currentUser.avatar_url})`;
        avatarEl.style.backgroundSize = 'cover';
        avatarEl.style.backgroundPosition = 'center';
        avatarEl.textContent = '';
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –±—É–∫–≤—É username
        const letter = currentUser.username.charAt(0).toUpperCase();
        avatarEl.style.backgroundImage = 'none';
        avatarEl.textContent = letter;
    }
}

async function login() {
    const identifier = document.getElementById('loginEmail').value.trim().toLowerCase();
    const password = document.getElementById('loginPassword').value;
    const errorDiv = document.getElementById('loginError');
    
    errorDiv.innerHTML = '';
    
    if (!identifier || !password) {
        errorDiv.innerHTML = '<div class="error-msg">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!</div>';
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ Turnstile (–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ)
    // if (!loginTurnstileToken) {
    //     errorDiv.innerHTML = '<div class="error-msg">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —á—Ç–æ –≤—ã –Ω–µ —Ä–æ–±–æ—Ç!</div>';
    //     return;
    // }
    
    try {
        let email = identifier;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ email –∏–ª–∏ username
        if (!identifier.includes('@')) {
            // –≠—Ç–æ username, –∏—â–µ–º email –≤ –±–∞–∑–µ
            const { data: userData, error: userError } = await supabase
                .from('users')
                .select('email')
                .eq('username', identifier)
                .maybeSingle();
            
            if (userError || !userData) {
                errorDiv.innerHTML = '<div class="error-msg">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!</div>';
                return;
            }
            
            email = userData.email;
        }
        
        // –í—Ö–æ–¥–∏–º —á–µ—Ä–µ–∑ Supabase Auth
        const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
            email: email, 
            password: password
        });
        
        if (authError) {
            errorDiv.innerHTML = '<div class="error-msg">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!</div>';
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã
        const { data: userData, error: dbError } = await supabase
            .from('users')
            .select('*')
            .eq('email', email)
            .maybeSingle();
        
        if (!userData) {
            errorDiv.innerHTML = '<div class="error-msg">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!</div>';
            return;
        }
        
        currentUser = userData;
        loginTurnstileToken = null; // –°–±—Ä–æ—Å —Ç–æ–∫–µ–Ω–∞
        closeModal('loginModal');
        showUserProfile();
        updateLangText();
    } catch (error) {
        errorDiv.innerHTML = '<div class="error-msg">–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</div>';
        console.error(error);
    }
}

async function logout() {
    await supabase.auth.signOut();
    currentUser = null;
    
    // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π ID —á–∞—Ç–∞
    try {
        sessionStorage.removeItem('currentChatId');
    } catch (e) {}
    
    showAuthButton();
    document.getElementById('profileSection').style.display = 'none';
    document.getElementById('marketplaceSection').style.display = 'none';
    document.getElementById('chatsSection').style.display = 'none';
    document.getElementById('chatSection').style.display = 'none';
    document.getElementById('games').style.display = 'block';
    
    const publicProfileSection = document.getElementById('publicProfileSection');
    if (publicProfileSection) publicProfileSection.style.display = 'none';
}

// === –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –°–ï–ö–¶–ò–Ø–ú–ò ===

function showMarketplace() {
    document.getElementById('profileSection').style.display = 'none';
    document.getElementById('games').style.display = 'none';
    document.getElementById('chatsSection').style.display = 'none';
    document.getElementById('chatSection').style.display = 'none';
    document.getElementById('marketplaceSection').style.display = 'block';
    
    const publicProfileSection = document.getElementById('publicProfileSection');
    if (publicProfileSection) publicProfileSection.style.display = 'none';
    
    loadMarketplace();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showChats() {
    if (!currentUser) {
        openModal('loginModal');
        return;
    }
    
    // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π ID —á–∞—Ç–∞
    try {
        sessionStorage.removeItem('currentChatId');
    } catch (e) {}
    
    document.getElementById('profileSection').style.display = 'none';
    document.getElementById('games').style.display = 'none';
    document.getElementById('marketplaceSection').style.display = 'none';
    document.getElementById('chatSection').style.display = 'none';
    document.getElementById('chatsSection').style.display = 'block';
    
    const publicProfileSection = document.getElementById('publicProfileSection');
    if (publicProfileSection) publicProfileSection.style.display = 'none';
    
    loadChats();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showGames() {
    // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π ID —á–∞—Ç–∞
    try {
        sessionStorage.removeItem('currentChatId');
    } catch (e) {}
    
    document.getElementById('profileSection').style.display = 'none';
    document.getElementById('marketplaceSection').style.display = 'none';
    document.getElementById('chatsSection').style.display = 'none';
    document.getElementById('chatSection').style.display = 'none';
    document.getElementById('games').style.display = 'block';
    
    const publicProfileSection = document.getElementById('publicProfileSection');
    if (publicProfileSection) publicProfileSection.style.display = 'none';
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showMyItems() {
    showMarketplace();
    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ç–æ–≤–∞—Ä—ã
    setTimeout(() => {
        filterMarketplace(true);
    }, 100);
}

// === –ú–ê–†–ö–ï–¢–ü–õ–ï–ô–° ===

let allMarketplaceItems = [];

async function loadMarketplace() {
    console.log('üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å...');
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥–∞–≤—Ü–∞—Ö
        const { data: items, error } = await supabase
            .from('items')
            .select(`
                *,
                seller:users!seller_id(id, username, avatar_url)
            `)
            .order('created_at', { ascending: false });
        
        if (error) throw error;
        
        console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:', items ? items.length : 0);
        
        allMarketplaceItems = items || [];
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –∏–≥—Ä
        await fillGameFilter();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã
        displayMarketplaceItems(allMarketplaceItems);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞:', error);
    }
}

async function fillGameFilter() {
    const filterSelect = document.getElementById('gameFilter');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä –∏–∑ products
    const { data: games } = await supabase
        .from('products')
        .select('name')
        .order('name');
    
    if (games && games.length > 0) {
        games.forEach(game => {
            const option = document.createElement('option');
            option.value = game.name;
            option.textContent = game.name;
            filterSelect.appendChild(option);
        });
    }
}

function displayMarketplaceItems(items) {
    const container = document.getElementById('marketplaceItems');
    const emptyState = document.getElementById('marketplaceEmpty');
    
    if (!items || items.length === 0) {
        container.innerHTML = '';
        container.style.display = 'none';
        emptyState.style.display = 'block';
        return;
    }
    
    container.style.display = 'grid';
    emptyState.style.display = 'none';
    
    container.innerHTML = items.map(item => `
        <div class="game-card" style="cursor:pointer;transition:all 0.3s;" onclick="showItemCard(${item.id})">
            <div>
                <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px;">
                    <span style="background:rgba(91,163,245,0.2);color:#5ba3f5;padding:4px 12px;border-radius:20px;font-size:13px;font-weight:600;">${item.game}</span>
                    <div style="display:flex;align-items:center;gap:8px;" onclick="event.stopPropagation(); showPublicProfile('${item.seller.username}')" style="cursor:pointer;" title="–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
                        ${item.seller.avatar_url ? 
                            `<div style="width:24px;height:24px;border-radius:50%;background-image:url(${item.seller.avatar_url});background-size:cover;"></div>` :
                            `<div style="width:24px;height:24px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;font-size:12px;color:white;">${item.seller.username.charAt(0).toUpperCase()}</div>`
                        }
                        <span style="color:var(--text-secondary);font-size:13px;text-decoration:underline;cursor:pointer;">${item.seller.username}</span>
                    </div>
                </div>
                <h3 style="margin:15px 0 10px 0;font-size:18px;color:var(--text-primary);">${item.title}</h3>
                <p style="color:var(--text-secondary);font-size:14px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${item.description}</p>
            </div>
            <div>
                <div class="game-price" style="margin-top:15px;">
                    <span class="price-display">${item.price}‚ÇΩ</span>
                </div>
                <button class="btn" onclick="event.stopPropagation(); showItemCard(${item.id})" style="width:100%;margin-top:10px;" data-lang-text="–û—Ç–∫—Ä—ã—Ç—å|Open">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    `).join('');
    
    updateLangText();
}

function filterMarketplace(myItemsOnly = false) {
    let filtered = [...allMarketplaceItems];
    
    // –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ –º–æ–∏ —Ç–æ–≤–∞—Ä—ã
    if (myItemsOnly && currentUser) {
        filtered = filtered.filter(item => item.seller_id === currentUser.id);
    }
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –∏–≥—Ä–µ
    const gameFilter = document.getElementById('gameFilter').value;
    if (gameFilter) {
        filtered = filtered.filter(item => item.game === gameFilter);
    }
    
    // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
    const searchQuery = document.getElementById('marketplaceSearch').value.toLowerCase();
    if (searchQuery) {
        filtered = filtered.filter(item => 
            item.title.toLowerCase().includes(searchQuery) ||
            item.description.toLowerCase().includes(searchQuery)
        );
    }
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    const sortFilter = document.getElementById('sortFilter').value;
    if (sortFilter === 'price_asc') {
        filtered.sort((a, b) => a.price - b.price);
    } else if (sortFilter === 'price_desc') {
        filtered.sort((a, b) => b.price - a.price);
    } else {
        // newest (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    }
    
    displayMarketplaceItems(filtered);
}

async function createItem() {
    if (!currentUser) {
        openModal('loginModal');
        return;
    }
    
    const game = document.getElementById('itemGame').value;
    const title = document.getElementById('itemTitle').value.trim();
    const price = parseFloat(document.getElementById('itemPrice').value);
    const description = document.getElementById('itemDescription').value.trim();
    const errorDiv = document.getElementById('createItemError');
    const btn = document.getElementById('createItemBtn');
    
    errorDiv.innerHTML = '';
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!game) {
        errorDiv.innerHTML = '<div class="error-msg">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É!</div>';
        return;
    }
    
    if (!title || title.length < 5) {
        errorDiv.innerHTML = '<div class="error-msg">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤!</div>';
        return;
    }
    
    if (!price || price < 1) {
        errorDiv.innerHTML = '<div class="error-msg">–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É!</div>';
        return;
    }
    
    if (!description || description.length < 20) {
        errorDiv.innerHTML = '<div class="error-msg">–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤!</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span> –ü—É–±–ª–∏–∫–∞—Ü–∏—è...';
    
    try {
        console.log('üì§ –°–æ–∑–¥–∞—ë–º —Ç–æ–≤–∞—Ä...');
        
        const { data, error } = await supabase
            .from('items')
            .insert([{
                seller_id: currentUser.id,
                game: game,
                title: title,
                price: price,
                description: description
            }])
            .select()
            .single();
        
        if (error) throw error;
        
        console.log('‚úÖ –¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω:', data);
        
        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        document.getElementById('itemGame').value = '';
        document.getElementById('itemTitle').value = '';
        document.getElementById('itemPrice').value = '';
        document.getElementById('itemDescription').value = '';
        
        closeModal('createItemModal');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
        await updateProfileItemsCount();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ
        showMarketplace();
        
        alert(currentLang === 'ru' ? '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!' : 'Item published successfully!');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = currentLang === 'ru' ? '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å' : 'Publish';
        updateLangText();
    }
}

async function showItemCard(itemId) {
    console.log('üì¶ –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞:', itemId);
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥–∞–≤—Ü–µ
        const { data: item, error } = await supabase
            .from('items')
            .select(`
                *,
                seller:users!seller_id(id, username, avatar_url, email)
            `)
            .eq('id', itemId)
            .single();
        
        if (error) throw error;
        
        console.log('‚úÖ –¢–æ–≤–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω:', item);
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
        const cardHtml = `
            <div style="background:var(--bg-secondary);padding:30px;border-radius:20px;">
                <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:20px;">
                    <span style="background:rgba(91,163,245,0.2);color:#5ba3f5;padding:6px 16px;border-radius:25px;font-size:14px;font-weight:600;">${item.game}</span>
                    <span style="color:var(--text-secondary);font-size:13px;">${new Date(item.created_at).toLocaleDateString('ru-RU')}</span>
                </div>
                
                <h2 style="font-size:28px;margin:20px 0;color:var(--text-primary);">${item.title}</h2>
                
                <div onclick="showPublicProfile('${item.seller.username}')" style="display:flex;align-items:center;gap:12px;padding:15px;background:var(--bg-primary);border-radius:15px;margin-bottom:25px;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='var(--bg-primary)'">
                    ${item.seller.avatar_url ? 
                        `<div style="width:50px;height:50px;border-radius:50%;background-image:url(${item.seller.avatar_url});background-size:cover;"></div>` :
                        `<div style="width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;font-size:22px;color:white;">${item.seller.username.charAt(0).toUpperCase()}</div>`
                    }
                    <div>
                        <div style="font-weight:600;color:var(--text-primary);text-decoration:underline;">${item.seller.username}</div>
                        <div style="font-size:13px;color:var(--text-secondary);">–ü—Ä–æ–¥–∞–≤–µ—Ü (–∫–ª–∏–∫–Ω–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è)</div>
                    </div>
                </div>
                
                <div style="background:var(--bg-primary);padding:20px;border-radius:15px;margin-bottom:25px;">
                    <h3 style="margin:0 0 15px 0;font-size:16px;color:var(--text-primary);">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p style="color:var(--text-secondary);line-height:1.8;white-space:pre-wrap;">${item.description}</p>
                </div>
                
                <div style="display:flex;justify-content:space-between;align-items:center;gap:20px;padding:25px;background:linear-gradient(135deg,rgba(91,163,245,0.1) 0%,rgba(74,144,226,0.1) 100%);border-radius:15px;border:2px solid rgba(91,163,245,0.3);flex-wrap:wrap;">
                    <div style="min-width:150px;">
                        <div style="font-size:14px;color:var(--text-secondary);margin-bottom:5px;">–¶–µ–Ω–∞</div>
                        <div style="font-size:36px;font-weight:bold;color:#5ba3f5;">${item.price}‚ÇΩ</div>
                    </div>
                    ${currentUser && currentUser.id !== item.seller_id ? 
                        `<button class="form-submit" onclick="openChatWithSeller(${item.id})" style="padding:15px 40px;font-size:18px;flex-shrink:0;" data-lang-text="üí¨ –ö—É–ø–∏—Ç—å|üí¨ Buy">üí¨ –ö—É–ø–∏—Ç—å</button>` :
                        currentUser && currentUser.id === item.seller_id ?
                        `<button class="form-submit" style="padding:15px 40px;font-size:18px;background:#666;cursor:not-allowed;flex-shrink:0;" disabled>–≠—Ç–æ –≤–∞—à —Ç–æ–≤–∞—Ä</button>` :
                        `<button class="form-submit" onclick="closeModal('itemModal'); openModal('loginModal')" style="padding:15px 40px;font-size:18px;flex-shrink:0;">–í–æ–π—Ç–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏</button>`
                    }
                </div>
            </div>
        `;
        
        document.getElementById('itemCard').innerHTML = cardHtml;
        openModal('itemModal');
        updateLangText();
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞!');
    }
}

async function updateProfileItemsCount() {
    if (!currentUser) return;
    
    try {
        const { count } = await supabase
            .from('items')
            .select('*', { count: 'exact', head: true })
            .eq('seller_id', currentUser.id);
        
        document.getElementById('profileItemsCount').textContent = count || 0;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á—ë—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤:', error);
    }
}

// === –°–ò–°–¢–ï–ú–ê –ß–ê–¢–û–í ===

let currentChat = null;
let chatRealtimeSubscription = null;

async function openChatWithSeller(itemId) {
    if (!currentUser) {
        closeModal('itemModal');
        openModal('loginModal');
        return;
    }
    
    console.log('üí¨ –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –¥–ª—è —Ç–æ–≤–∞—Ä–∞:', itemId);
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞
        const { data: item } = await supabase
            .from('items')
            .select('*, seller:users!seller_id(*)')
            .eq('id', itemId)
            .single();
        
        if (!item) {
            alert('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            return;
        }
        
        if (item.seller_id === currentUser.id) {
            alert('–≠—Ç–æ –≤–∞—à —Ç–æ–≤–∞—Ä!');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É–∂–µ —á–∞—Ç
        let { data: existingChat } = await supabase
            .from('chats')
            .select('*')
            .eq('buyer_id', currentUser.id)
            .eq('item_id', itemId)
            .single();
        
        if (!existingChat) {
            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —á–∞—Ç
            console.log('‚ûï –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —á–∞—Ç...');
            
            const { data: newChat, error } = await supabase
                .from('chats')
                .insert([{
                    buyer_id: currentUser.id,
                    seller_id: item.seller_id,
                    item_id: itemId
                }])
                .select()
                .single();
            
            if (error) throw error;
            
            existingChat = newChat;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            await supabase
                .from('messages')
                .insert([{
                    chat_id: existingChat.id,
                    sender_id: currentUser.id,
                    text: `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç "${item.title}". –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏?`
                }]);
            
            console.log('‚úÖ –ß–∞—Ç —Å–æ–∑–¥–∞–Ω:', existingChat.id);
        }
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç
        closeModal('itemModal');
        openChat(existingChat.id);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞:', error);
        alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞!');
    }
}

async function loadChats() {
    if (!currentUser) return;
    
    console.log('üí¨ –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç—ã...');
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç—ã –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –∏–ª–∏ –ø—Ä–æ–¥–∞–≤–µ—Ü
        const { data: chats, error } = await supabase
            .from('chats')
            .select(`
                *,
                item:items(*),
                buyer:users!buyer_id(id, username, avatar_url),
                seller:users!seller_id(id, username, avatar_url),
                last_message:messages(text, created_at, sender_id)
            `)
            .or(`buyer_id.eq.${currentUser.id},seller_id.eq.${currentUser.id}`)
            .order('updated_at', { ascending: false });
        
        if (error) throw error;
        
        console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —á–∞—Ç–æ–≤:', chats ? chats.length : 0);
        
        displayChats(chats || []);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º badge –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
        await updateUnreadBadge();
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', error);
    }
}

function displayChats(chats) {
    const container = document.getElementById('chatsList');
    const emptyState = document.getElementById('chatsEmpty');
    
    if (!chats || chats.length === 0) {
        container.innerHTML = '';
        container.style.display = 'none';
        emptyState.style.display = 'block';
        return;
    }
    
    container.style.display = 'flex';
    emptyState.style.display = 'none';
    
    container.innerHTML = chats.map(chat => {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
        const isOurChat = chat.messages && chat.messages.length > 0;
        const interlocutor = chat.buyer_id === currentUser.id ? chat.seller : chat.buyer;
        const lastMessage = Array.isArray(chat.last_message) && chat.last_message.length > 0 ? chat.last_message[0] : null;
        
        return `
            <div onclick="openChat(${chat.id})" style="display:flex;align-items:center;gap:15px;padding:20px;background:var(--bg-secondary);border-radius:15px;cursor:pointer;transition:all 0.3s;border:2px solid transparent;" onmouseover="this.style.borderColor='#5ba3f5'" onmouseout="this.style.borderColor='transparent'">
                ${interlocutor.avatar_url ? 
                    `<div style="width:60px;height:60px;border-radius:50%;background-image:url(${interlocutor.avatar_url});background-size:cover;flex-shrink:0;"></div>` :
                    `<div style="width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;font-size:26px;color:white;flex-shrink:0;">${interlocutor.username.charAt(0).toUpperCase()}</div>`
                }
                <div style="flex:1;min-width:0;">
                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:5px;">
                        <h3 style="margin:0;font-size:18px;color:var(--text-primary);">${interlocutor.username}</h3>
                        <span style="font-size:12px;color:var(--text-secondary);">${lastMessage ? new Date(lastMessage.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'}) : ''}</span>
                    </div>
                    <p style="margin:5px 0 0 0;font-size:13px;color:#5ba3f5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${chat.item ? chat.item.title : '–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω'}</p>
                    ${lastMessage ? 
                        `<p style="margin:8px 0 0 0;font-size:14px;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${lastMessage.text}</p>` :
                        `<p style="margin:8px 0 0 0;font-size:14px;color:var(--text-secondary);">–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥...</p>`
                    }
                </div>
            </div>
        `;
    }).join('');
}

async function openChat(chatId) {
    console.log('üí¨ –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç:', chatId);
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç
        const { data: chat, error } = await supabase
            .from('chats')
            .select(`
                *,
                item:items(*),
                buyer:users!buyer_id(*),
                seller:users!seller_id(*)
            `)
            .eq('id', chatId)
            .single();
        
        if (error) throw error;
        
        currentChat = chat;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —á–∞—Ç–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
        try {
            sessionStorage.setItem('currentChatId', chatId);
        } catch (e) {
            console.warn('SessionStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', e);
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
        const interlocutor = chat.buyer_id === currentUser.id ? chat.seller : chat.buyer;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —à–∞–ø–∫—É —á–∞—Ç–∞
        const avatarEl = document.getElementById('chatUserAvatar');
        if (interlocutor.avatar_url) {
            avatarEl.style.backgroundImage = `url(${interlocutor.avatar_url})`;
            avatarEl.style.backgroundSize = 'cover';
            avatarEl.textContent = '';
        } else {
            avatarEl.style.backgroundImage = 'none';
            avatarEl.textContent = interlocutor.username.charAt(0).toUpperCase();
        }
        
        document.getElementById('chatUsername').textContent = interlocutor.username;
        document.getElementById('chatItemTitle').textContent = chat.item ? chat.item.title : '–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —á–∞—Ç–∞
        document.getElementById('chatsSection').style.display = 'none';
        document.getElementById('marketplaceSection').style.display = 'none';
        document.getElementById('chatSection').style.display = 'block';
        document.getElementById('games').style.display = 'none';
        document.getElementById('profileSection').style.display = 'none';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
        await loadMessages(chatId);
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        subscribeToMessages(chatId);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞!');
    }
}

async function loadMessages(chatId) {
    try {
        const { data: messages, error } = await supabase
            .from('messages')
            .select('*')
            .eq('chat_id', chatId)
            .order('created_at', { ascending: true });
        
        if (error) throw error;
        
        displayMessages(messages || []);
        
        // –ü–æ–º–µ—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
        await supabase
            .from('messages')
            .update({ is_read: true })
            .eq('chat_id', chatId)
            .neq('sender_id', currentUser.id)
            .eq('is_read', false);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
    }
}

function displayMessages(messages) {
    const container = document.getElementById('messagesContainer');
    
    if (!messages || messages.length === 0) {
        container.innerHTML = '<div style="text-align:center;color:var(--text-secondary);padding:40px;">–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥!</div>';
        return;
    }
    
    container.innerHTML = messages.map(msg => {
        const isMine = msg.sender_id === currentUser.id;
        return `
            <div style="display:flex;justify-content:${isMine ? 'flex-end' : 'flex-start'};margin-bottom:15px;">
                <div style="max-width:70%;padding:12px 16px;border-radius:${isMine ? '18px 18px 4px 18px' : '18px 18px 18px 4px'};background:${isMine ? 'linear-gradient(135deg,#5ba3f5 0%,#4A90E2 100%)' : 'var(--bg-primary)'};color:${isMine ? 'white' : 'var(--text-primary)'};">
                    <div style="word-wrap:break-word;margin-bottom:5px;">${msg.text}</div>
                    <div style="font-size:11px;opacity:0.7;text-align:right;">${new Date(msg.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</div>
                </div>
            </div>
        `;
    }).join('');
    
    // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
    container.scrollTop = container.scrollHeight;
}

async function sendMessage() {
    if (!currentChat) return;
    
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    
    if (!text) return;
    
    console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ...');
    
    try {
        const { error } = await supabase
            .from('messages')
            .insert([{
                chat_id: currentChat.id,
                sender_id: currentUser.id,
                text: text
            }]);
        
        if (error) throw error;
        
        // –û—á–∏—â–∞–µ–º input
        input.value = '';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º updated_at —á–∞—Ç–∞
        await supabase
            .from('chats')
            .update({ updated_at: new Date().toISOString() })
            .eq('id', currentChat.id);
        
        console.log('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
        
        // –°–æ–æ–±—â–µ–Ω–∏—è –æ–±–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ realtime
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è!');
    }
}

function subscribeToMessages(chatId) {
    // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
    if (chatRealtimeSubscription) {
        chatRealtimeSubscription.unsubscribe();
    }
    
    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    chatRealtimeSubscription = supabase
        .channel(`chat_${chatId}`)
        .on('postgres_changes', {
            event: 'INSERT',
            schema: 'public',
            table: 'messages',
            filter: `chat_id=eq.${chatId}`
        }, (payload) => {
            console.log('üì® –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', payload.new);
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadMessages(chatId);
        })
        .subscribe();
}

async function updateUnreadBadge() {
    if (!currentUser) return;
    
    try {
        // –°—á–∏—Ç–∞–µ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        const { count } = await supabase
            .from('messages')
            .select('*', { count: 'exact', head: true })
            .eq('is_read', false)
            .neq('sender_id', currentUser.id)
            .in('chat_id', 
                supabase
                    .from('chats')
                    .select('id')
                    .or(`buyer_id.eq.${currentUser.id},seller_id.eq.${currentUser.id}`)
            );
        
        const badge = document.getElementById('unreadBadge');
        if (count && count > 0) {
            badge.textContent = count;
            badge.style.display = 'block';
        } else {
            badge.style.display = 'none';
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á—ë—Ç–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:', error);
    }
}

async function buyProduct(productName, price) {
    if (!currentUser) {
        openModal('loginModal');
        return;
    }
    
    // –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å
    if (currentUser.balance < price) {
        const confirmMsg = currentLang === 'ru' 
            ? `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –•–æ—Ç–∏—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤?`
            : `Insufficient balance! Want to see offers from other sellers?`;
        
        if (confirm(confirmMsg)) {
            showMarketplace();
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∏–≥—Ä–µ
            setTimeout(() => {
                document.getElementById('gameFilter').value = productName;
                filterMarketplace();
            }, 100);
        }
        return;
    }
    
    try {
        // –°–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–∞–Ω—Å
        const newBalance = currentUser.balance - price;
        const { error: balanceError } = await supabase
            .from('users')
            .update({ balance: newBalance })
            .eq('id', currentUser.id);
        
        if (balanceError) throw balanceError;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
        currentUser.balance = newBalance;
        updateBalance();
        
        alert(currentLang === 'ru' 
            ? `–¢–æ–≤–∞—Ä "${productName}" –∫—É–ø–ª–µ–Ω –∑–∞ ${price}‚ÇΩ! –°–≤—è–∂–∏—Ç–µ—Å—å —Å @lowv1rre –≤ Telegram –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è.` 
            : `Product "${productName}" purchased for ${price}‚ÇΩ! Contact @lowv1rre on Telegram to receive.`);
    } catch (error) {
        alert(currentLang === 'ru' ? '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ!' : 'Purchase error!');
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error);
    }
}

// === –ü–£–ë–õ–ò–ß–ù–´–ô –ü–†–û–§–ò–õ–¨ ===

async function showPublicProfile(username) {
    console.log('üë§ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å:', username);
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const { data: user, error: userError } = await supabase
            .from('users')
            .select('*')
            .eq('username', username)
            .single();
        
        if (userError || !user) {
            alert(currentLang === 'ru' ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!' : 'User not found!');
            return;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const { data: items } = await supabase
            .from('items')
            .select('*')
            .eq('seller_id', user.id)
            .order('created_at', { ascending: false });
        
        console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω:', user, items);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
        document.getElementById('profileSection').style.display = 'none';
        document.getElementById('games').style.display = 'none';
        document.getElementById('marketplaceSection').style.display = 'none';
        document.getElementById('chatsSection').style.display = 'none';
        document.getElementById('chatSection').style.display = 'none';
        
        // –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
        let publicProfileSection = document.getElementById('publicProfileSection');
        if (!publicProfileSection) {
            publicProfileSection = document.createElement('div');
            publicProfileSection.id = 'publicProfileSection';
            publicProfileSection.style.display = 'none';
            document.querySelector('.content-wrapper').appendChild(publicProfileSection);
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
        const avatarHtml = user.avatar_url 
            ? `<div class="profile-avatar" style="background-image:url(${user.avatar_url});background-size:cover;background-position:center;width:120px;height:120px;"></div>`
            : `<div class="profile-avatar" style="width:120px;height:120px;font-size:48px;">${user.username.charAt(0).toUpperCase()}</div>`;
        
        publicProfileSection.innerHTML = `
            <div class="container">
                <div class="profile-section">
                    <button onclick="history.back()" style="background:var(--bg-secondary);border:2px solid var(--border-color);padding:10px 20px;border-radius:10px;color:var(--text-primary);cursor:pointer;margin-bottom:20px;display:flex;align-items:center;gap:8px;">
                        ‚Üê <span data-lang-text="–ù–∞–∑–∞–¥|Back">–ù–∞–∑–∞–¥</span>
                    </button>
                    
                    <div style="display:flex;align-items:center;gap:20px;margin-bottom:30px;">
                        ${avatarHtml}
                        <div>
                            <h2 style="margin:0;font-size:32px;">${user.username}</h2>
                            <p style="margin:5px 0 0 0;color:var(--text-secondary);">lowv1re.eu/profile/${user.username}</p>
                            <p style="margin:10px 0 0 0;color:var(--text-secondary);">
                                <span data-lang-text="–ù–∞ —Å–∞–π—Ç–µ —Å|Member since">–ù–∞ —Å–∞–π—Ç–µ —Å</span> ${new Date(user.created_at).toLocaleDateString('ru-RU')}
                            </p>
                        </div>
                    </div>
                    
                    <h3 style="margin:30px 0 20px 0;"><span data-lang-text="–¢–æ–≤–∞—Ä—ã –ø—Ä–æ–¥–∞–≤—Ü–∞|Seller's items">–¢–æ–≤–∞—Ä—ã –ø—Ä–æ–¥–∞–≤—Ü–∞</span> (${items ? items.length : 0})</h3>
                    
                    ${items && items.length > 0 ? `
                        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;">
                            ${items.map(item => `
                                <div class="game-card" onclick="showItemCard(${item.id})" style="cursor:pointer;">
                                    <div>
                                        <div style="background:rgba(91,163,245,0.2);color:#5ba3f5;padding:4px 12px;border-radius:20px;font-size:13px;font-weight:600;display:inline-block;margin-bottom:10px;">${item.game}</div>
                                        <h3 style="margin:10px 0;font-size:18px;">${item.title}</h3>
                                        <p style="color:var(--text-secondary);font-size:14px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${item.description}</p>
                                    </div>
                                    <div>
                                        <div class="game-price" style="margin-top:15px;">
                                            <span class="price-display">${item.price}‚ÇΩ</span>
                                        </div>
                                        <button class="btn" onclick="event.stopPropagation(); showItemCard(${item.id})" style="width:100%;margin-top:10px;" data-lang-text="–û—Ç–∫—Ä—ã—Ç—å|Open">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div style="text-align:center;padding:60px 20px;color:var(--text-secondary);">
                            <div style="font-size:64px;margin-bottom:20px;">üì¶</div>
                            <h3 data-lang-text="–£ –ø—Ä–æ–¥–∞–≤—Ü–∞ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤|Seller has no items yet">–£ –ø—Ä–æ–¥–∞–≤—Ü–∞ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</h3>
                        </div>
                    `}
                </div>
            </div>
        `;
        
        publicProfileSection.style.display = 'block';
        updateLangText();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
        alert(currentLang === 'ru' ? '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è!' : 'Error loading profile!');
    }
}

// Cloudflare Turnstile callbacks
function onLoginTurnstileSuccess(token) {
    loginTurnstileToken = token;
    console.log('‚úÖ Login Turnstile verified');
}

function onRegisterTurnstileSuccess(token) {
    registerTurnstileToken = token;
    console.log('‚úÖ Register Turnstile verified');
}

function openModal(modalId) { 
    clearMessages(modalId.replace('Modal', 'Error'));
    document.getElementById(modalId).classList.add('active');
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
    if (modalId === 'createItemModal') {
        fillItemGameSelect();
    }
}

async function fillItemGameSelect() {
    const select = document.getElementById('itemGame');
    
    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π)
    while (select.options.length > 1) {
        select.remove(1);
    }
    
    try {
        const { data: games } = await supabase
            .from('products')
            .select('name')
            .order('name');
        
        if (games && games.length > 0) {
            games.forEach(game => {
                const option = document.createElement('option');
                option.value = game.name;
                option.textContent = game.name;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä:', error);
    }
}

function closeModal(modalId) { 
    document.getElementById(modalId).classList.remove('active');
    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    clearForm(modalId);
    clearMessages(modalId.replace('Modal', 'Error'));
    
    // –°–±—Ä–æ—Å Turnstile –≤–∏–¥–∂–µ—Ç–æ–≤
    if (modalId === 'loginModal') {
        loginTurnstileToken = null;
        if (window.turnstile) {
            const widgets = document.querySelectorAll('#loginModal .cf-turnstile');
            widgets.forEach(widget => {
                try {
                    turnstile.reset(widget);
                } catch (e) {}
            });
        }
    } else if (modalId === 'registerModal') {
        registerTurnstileToken = null;
        if (window.turnstile) {
            const widgets = document.querySelectorAll('#registerModal .cf-turnstile');
            widgets.forEach(widget => {
                try {
                    turnstile.reset(widget);
                } catch (e) {}
            });
        }
    }
}

function switchModal(from, to) { 
    closeModal(from); 
    openModal(to); 
}

async function sendRecovery() {
    const email = document.getElementById('forgotEmail').value.trim().toLowerCase();
    const errorDiv = document.getElementById('forgotError');
    const btn = document.getElementById('forgotBtn');
    
    errorDiv.innerHTML = '';
    
    if (!email) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ email!</div>';
        return;
    }
    
    if (!isValidEmail(email)) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email!</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–û—Ç–ø—Ä–∞–≤–∫–∞...|Sending...">–û—Ç–ø—Ä–∞–≤–∫–∞...</span>';
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email
        const { data: userData } = await supabase
            .from('users')
            .select('*')
            .eq('email', email)
            .maybeSingle();
        
        if (!userData) {
            errorDiv.innerHTML = '<div class="error-msg">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥|Send code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</span>';
            updateLangText();
            return;
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
        const code = generateCode();
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–¥—ã –¥–ª—è —ç—Ç–æ–≥–æ email
        await supabase.from('recovery_codes').delete().eq('email', email);
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–¥ (–∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç)
        const expiresAt = new Date(Date.now() + 10 * 60 * 1000);
        
        await supabase.from('recovery_codes').insert([{
            email: email,
            code: code,
            expires_at: expiresAt.toISOString(),
            used: false
        }]);
        
        console.log('===================');
        console.log('–ö–û–î –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø:', code);
        console.log('EMAIL:', email);
        console.log('–ò–°–¢–ï–ö–ê–ï–¢:', expiresAt.toISOString());
        console.log('===================');
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥ —á–µ—Ä–µ–∑ Edge Function
        const emailSent = await sendEmailCode(email, code, 'recovery');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º email –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞
        recoveryEmail = email;
        
        if (emailSent) {
            errorDiv.innerHTML = '<div class="success-msg">‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ—á—Ç—É! –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤–≤–æ–¥—É –∫–æ–¥–∞...</div>';
        } else {
            errorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ö–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12)! –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤–≤–æ–¥—É –∫–æ–¥–∞...</div>';
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –º–æ–¥–∞–ª–∫—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞
        setTimeout(() => {
            closeModal('forgotModal');
            openModal('resetModal');
            document.getElementById('resetCode').focus();
        }, 1500);
        
    } catch (error) {
        console.error('Recovery error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥|Send code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</span>';
        updateLangText();
    }
}

async function verifyCode() {
    const code = document.getElementById('resetCode').value.trim();
    const errorDiv = document.getElementById('resetError');
    const btn = document.getElementById('resetBtn');
    
    errorDiv.innerHTML = '';
    
    if (!code || code.length !== 6) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥!</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∫–∞...|Verifying...">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>';
    
    try {
        const { data: codeData, error } = await supabase
            .from('recovery_codes')
            .select('*')
            .eq('email', recoveryEmail)
            .eq('code', code)
            .eq('used', false)
            .maybeSingle();
        
        if (error || !codeData) {
            errorDiv.innerHTML = '<div class="error-msg">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</span>';
            updateLangText();
            return;
        }
        
        const expiresAt = new Date(codeData.expires_at);
        const now = new Date();
        
        console.log('‚è∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:');
        console.log('   –°–µ–π—á–∞—Å:', now.toISOString());
        console.log('   –ò—Å—Ç–µ–∫–∞–µ—Ç:', expiresAt.toISOString());
        console.log('   –†–∞–∑–Ω–∏—Ü–∞ (–º–∏–Ω—É—Ç):', (expiresAt - now) / 60000);
        
        if (now.getTime() > expiresAt.getTime()) {
            errorDiv.innerHTML = '<div class="error-msg">–ö–æ–¥ –∏—Å—Ç—ë–∫! –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π.</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</span>';
            updateLangText();
            return;
        }
        
        verifiedCode = code;
        errorDiv.innerHTML = '<div class="success-msg">–ö–æ–¥ –≤–µ—Ä–µ–Ω!</div>';
        
        setTimeout(() => {
            closeModal('resetModal');
            openModal('newPasswordModal');
            document.getElementById('newPassword').focus();
        }, 1000);
        
    } catch (error) {
        console.error('Code verification error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</span>';
        updateLangText();
    }
}

async function resendCode() {
    if (!recoveryEmail) {
        alert('–û—à–∏–±–∫–∞! –ù–∞—á–Ω–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ.');
        return;
    }
    
    const errorDiv = document.getElementById('resetError');
    errorDiv.innerHTML = '<div class="success-msg">–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞...</div>';
    
    const code = generateCode();
    
    try {
        await supabase.from('recovery_codes').delete().eq('email', recoveryEmail);
        
        const expiresAt = new Date(Date.now() + 10 * 60 * 1000);
        
        await supabase.from('recovery_codes').insert([{
            email: recoveryEmail,
            code: code,
            expires_at: expiresAt.toISOString(),
            used: false
        }]);
        
        console.log('===================');
        console.log('–ù–û–í–´–ô –ö–û–î –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø:', code);
        console.log('EMAIL:', recoveryEmail);
        console.log('===================');
        
        const emailSent = await sendEmailCode(recoveryEmail, code, 'recovery');
        
        if (emailSent) {
            errorDiv.innerHTML = '<div class="success-msg">‚úÖ –ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!</div>';
        } else {
            errorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ù–æ–≤—ã–π –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12)!</div>';
        }
        
        document.getElementById('resetCode').value = '';
        document.getElementById('resetCode').focus();
    } catch (error) {
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    }
}

async function saveNewPassword() {
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('newPasswordConfirm').value;
    const errorDiv = document.getElementById('newPasswordError');
    const btn = document.getElementById('newPasswordBtn');
    
    errorDiv.innerHTML = '';
    
    if (!newPassword || !confirmPassword) {
        errorDiv.innerHTML = '<div class="error-msg">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!</div>';
        return;
    }
    
    if (newPassword !== confirmPassword) {
        errorDiv.innerHTML = '<div class="error-msg">–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!</div>';
        return;
    }
    
    if (newPassword.length < 6) {
        errorDiv.innerHTML = '<div class="error-msg">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...|Saving...">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>';
    
    try {
        console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –¥–ª—è:', recoveryEmail);
        
        // –û—Ç–º–µ—á–∞–µ–º –∫–æ–¥ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
        await supabase
            .from('recovery_codes')
            .update({ used: true })
            .eq('code', verifiedCode);
        
        // –í—ã–∑—ã–≤–∞–µ–º Edge Function –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
        const response = await fetch('https://nbelgmhtxjjlfpqmkqbl.supabase.co/functions/v1/reset-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${SUPABASE_KEY}`
            },
            body: JSON.stringify({
                email: recoveryEmail,
                newPassword: newPassword
            })
        });
        
        const data = await response.json();
        
        if (!response.ok || data.error) {
            throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è');
        }
        
        console.log('‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω —á–µ—Ä–µ–∑ Edge Function!');
        
        errorDiv.innerHTML = '<div class="success-msg">üí• –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.</div>';
        
        setTimeout(() => {
            closeModal('newPasswordModal');
            openModal('loginModal');
            document.getElementById('loginEmail').value = recoveryEmail;
            document.getElementById('loginPassword').focus();
            recoveryEmail = '';
            verifiedCode = '';
        }, 2500);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å|Save password">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</span>';
        updateLangText();
    }
}

const langSwitch = document.getElementById('langSwitch');
langSwitch.addEventListener('click', () => {
    currentLang = currentLang === 'ru' ? 'en' : 'ru';
    langSwitch.textContent = currentLang.toUpperCase();
    const langSwitchMobile = document.getElementById('langSwitchMobile');
    if (langSwitchMobile) langSwitchMobile.textContent = currentLang.toUpperCase();
    updateLangText();
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞
const langSwitchMobile = document.getElementById('langSwitchMobile');
if (langSwitchMobile) {
    langSwitchMobile.addEventListener('click', () => {
        currentLang = currentLang === 'ru' ? 'en' : 'ru';
        langSwitch.textContent = currentLang.toUpperCase();
        langSwitchMobile.textContent = currentLang.toUpperCase();
        updateLangText();
    });
}

function updateLangText() {
    document.querySelectorAll('[data-lang-text]').forEach(el => {
        const texts = el.dataset.langText.split('|');
        if (el.tagName === 'OPTION') {
            el.textContent = currentLang === 'ru' ? texts[0] : texts[1];
        } else {
            el.innerHTML = currentLang === 'ru' ? texts[0] : texts[1];
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ placeholder'–æ–≤
    document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
        const texts = el.dataset.langPlaceholder.split('|');
        el.placeholder = currentLang === 'ru' ? texts[0] : texts[1];
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ "–û–¢"/"FROM"
    updateAllPrices();
}

let lastScroll = 0;
const header = document.getElementById('header');
const HEADER_HIDE_POINT = 150;

window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > HEADER_HIDE_POINT) {
        if (currentScroll > lastScroll) {
            header.classList.add('hidden');
        }
    } else {
        header.classList.remove('hidden');
    }
    
    lastScroll = currentScroll;
});
</script>
</body>
</html>
