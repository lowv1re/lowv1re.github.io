<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOWV1RE - –ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö —É—Å–ª—É–≥</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #0a0a0a;
    color: #ffffff;
    line-height: 1.6;
    min-height: 100vh;
}

/* Header */
.header {
    background: #121212;
    border-bottom: 1px solid #1e1e23;
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 70px;
}

.logo {
    font-size: 28px;
    font-weight: 700;
    color: #4A90E2;
    text-decoration: none;
    letter-spacing: -0.5px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo:hover {
    color: #5ba3f5;
}

.nav-links {
    display: flex;
    gap: 40px;
    align-items: center;
}

.nav-links a {
    color: #b0b0b0;
    text-decoration: none;
    font-weight: 500;
    font-size: 15px;
    transition: color 0.3s;
}

.nav-links a:hover {
    color: #ffffff;
}

.lang-switch {
    background: #1e1e23;
    border: 1px solid #2a2a2f;
    color: #b0b0b0;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s;
}

.lang-switch:hover {
    background: #2a2a2f;
    color: #ffffff;
}

/* Hero Section */
.hero {
    padding: 100px 20px;
    text-align: center;
    background: linear-gradient(180deg, #121212 0%, #0a0a0a 100%);
}

.hero h1 {
    font-size: 56px;
    font-weight: 800;
    margin-bottom: 20px;
    background: linear-gradient(135deg, #4A90E2, #7B68EE);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero p {
    font-size: 20px;
    color: #b0b0b0;
    margin-bottom: 40px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.cta-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn {
    padding: 14px 32px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: linear-gradient(135deg, #4A90E2, #667eea);
    color: #ffffff;
    box-shadow: 0 4px 20px rgba(74, 144, 226, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 30px rgba(74, 144, 226, 0.4);
}

.btn-secondary {
    background: #1e1e23;
    color: #ffffff;
    border: 1px solid #2a2a2f;
}

.btn-secondary:hover {
    background: #2a2a2f;
    border-color: #4A90E2;
}

/* Games Section */
.games-section {
    padding: 80px 20px;
}

.section-title {
    font-size: 36px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 50px;
}

.games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 24px;
    max-width: 1400px;
    margin: 0 auto;
}

.game-card {
    background: #121212;
    border: 1px solid #1e1e23;
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s;
    cursor: pointer;
}

.game-card:hover {
    transform: translateY(-4px);
    border-color: #4A90E2;
    box-shadow: 0 8px 32px rgba(74, 144, 226, 0.15);
}

.game-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    margin-bottom: 20px;
}

.game-card h3 {
    font-size: 22px;
    margin-bottom: 10px;
    color: #ffffff;
}

.game-card p {
    color: #b0b0b0;
    font-size: 14px;
    margin-bottom: 16px;
}

.price-tag {
    display: flex;
    gap: 16px;
    align-items: center;
    flex-wrap: wrap;
}

.price {
    font-size: 18px;
    font-weight: 700;
    color: #4A90E2;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: #121212;
    border: 1px solid #1e1e23;
    border-radius: 20px;
    max-width: 480px;
    width: 100%;
    padding: 40px;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 28px;
    color: #666;
    cursor: pointer;
    transition: color 0.3s;
    background: none;
    border: none;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    color: #ffffff;
}

.modal-title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 30px;
    text-align: center;
    color: #ffffff;
}

.modal-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    background: #0a0a0a;
    padding: 6px;
    border-radius: 12px;
}

.tab {
    flex: 1;
    padding: 12px;
    text-align: center;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    color: #b0b0b0;
}

.tab.active {
    background: #1e1e23;
    color: #ffffff;
}

/* Form */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #b0b0b0;
    font-size: 14px;
}

.form-group input {
    width: 100%;
    padding: 14px 16px;
    background: #1e1e23;
    border: 1px solid #2a2a2f;
    border-radius: 10px;
    color: #ffffff;
    font-size: 15px;
    transition: all 0.3s;
}

.form-group input:focus {
    outline: none;
    border-color: #4A90E2;
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
}

.form-group input.error {
    border-color: #FF4757;
}

.form-submit {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #4A90E2, #667eea);
    border: none;
    border-radius: 10px;
    color: #ffffff;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
}

.form-submit:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.3);
}

.form-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.form-switch {
    text-align: center;
    margin-top: 20px;
    color: #b0b0b0;
    font-size: 14px;
}

.form-switch a {
    color: #4A90E2;
    text-decoration: none;
    cursor: pointer;
    font-weight: 600;
}

.form-switch a:hover {
    text-decoration: underline;
}

/* Messages */
.error-msg, .success-msg {
    padding: 12px 16px;
    border-radius: 10px;
    margin-bottom: 20px;
    font-size: 14px;
    font-weight: 500;
}

.error-msg {
    background: rgba(255, 71, 87, 0.1);
    border: 1px solid rgba(255, 71, 87, 0.3);
    color: #FF4757;
}

.success-msg {
    background: rgba(0, 210, 106, 0.1);
    border: 1px solid rgba(0, 210, 106, 0.3);
    color: #00D26A;
}

/* Loading */
.loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: #ffffff;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    margin-right: 8px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Profile */
.profile-container {
    max-width: 1200px;
    margin: 40px auto;
    padding: 0 20px;
}

.profile-header {
    background: #121212;
    border: 1px solid #1e1e23;
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.profile-info h2 {
    font-size: 32px;
    margin-bottom: 10px;
}

.profile-info p {
    color: #b0b0b0;
    font-size: 16px;
}

.balance-card {
    background: linear-gradient(135deg, #667eea, #764ba2);
    padding: 24px 32px;
    border-radius: 16px;
    text-align: center;
}

.balance-card p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    margin-bottom: 8px;
}

.balance-card h3 {
    font-size: 36px;
    font-weight: 700;
}

/* Responsive */
@media (max-width: 768px) {
    .hero h1 {
        font-size: 36px;
    }
    
    .hero p {
        font-size: 16px;
    }
    
    .nav-links {
        display: none;
    }
    
    .games-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        padding: 30px 20px;
    }
}
</style>
</head>
<body>
<div class="content-wrapper">
<div class="header" id="header">
<div class="container">
<div class="nav">
<a href="#" class="logo" onclick="window.location.reload()">üéÆ LOWV1RE</a>
<div class="nav-links">
<a href="#games" data-lang-text="–ò–≥—Ä—ã|Games">–ò–≥—Ä—ã</a>
<a href="#services" data-lang-text="–£—Å–ª—É–≥–∏|Services">–£—Å–ª—É–≥–∏</a>
<a href="#contact" data-lang-text="–ö–æ–Ω—Ç–∞–∫—Ç—ã|Contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
<div id="authSection"></div>
<div class="lang-switch" id="langSwitch">RU</div>
</div>
</div>
</div>
</div>

<div class="hero">
<div class="container">
<h1 id="heroTitle" data-lang-text="LOWV1RE MARKET|LOWV1RE MARKET">LOWV1RE MARKET</h1>
<p id="heroDesc" data-lang-text="–î–æ–Ω–∞—Ç. –ê–∫–∫–∞—É–Ω—Ç—ã. –ü—Ä–æ–∫–∞—á–∫–∞. –í—Å—ë –ø–æ–¥ —Ç–≤–æ–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.|Donations. Accounts. Boosting. Everything under your control.">–î–æ–Ω–∞—Ç. –ê–∫–∫–∞—É–Ω—Ç—ã. –ü—Ä–æ–∫–∞—á–∫–∞. –í—Å—ë –ø–æ–¥ —Ç–≤–æ–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.</p>
<div class="cta-buttons">
<button class="btn btn-primary" onclick="openModal('loginModal')" data-lang-text="–í–æ–π—Ç–∏|Login">–í–æ–π—Ç–∏</button>
<button class="btn btn-secondary" onclick="openModal('registerModal')" data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è|Register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>
</div>
</div>

<div id="profileSection" style="display:none;">
<div class="container">
<div class="profile-section">
<div class="profile-header">
<div class="profile-avatar" id="profileAvatar">U</div>
<div class="profile-info">
<h2 id="profileUsername">Username</h2>
<p id="profileEmail">email@example.com</p>
<p id="profileUrl" style="color:#ff8c00; margin-top:5px; font-size:16px;">lowv1re.eu/user1</p>
</div>
</div>
<div class="profile-stats">
<div class="stat-box">
<div class="stat-label" data-lang-text="–ë–∞–ª–∞–Ω—Å|Balance">–ë–∞–ª–∞–Ω—Å</div>
<div class="stat-value" id="profileBalance">0‚ÇΩ</div>
</div>
<div class="stat-box">
<div class="stat-label" data-lang-text="–ó–∞–∫–∞–∑–æ–≤|Orders">–ó–∞–∫–∞–∑–æ–≤</div>
<div class="stat-value" id="profileOrders">0</div>
</div>
<div class="stat-box">
<div class="stat-label" data-lang-text="–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏|Registered">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
<div class="stat-value" id="profileDate" style="font-size:14px;">--</div>
</div>
</div>
<button class="logout-btn" onclick="logout()" data-lang-text="–í—ã–π—Ç–∏|Logout">–í—ã–π—Ç–∏</button>
</div>
</div>
</div>

<div class="container" id="games">
<h2 class="section-title" data-lang-text="üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã|üéÆ Popular Games">üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã</h2>
<div class="games-grid">

<div class="game-card card-brawl">
<div>
<div class="game-icon">‚≠ê</div>
<h3 data-lang-text="Brawl Stars|Brawl Stars">Brawl Stars</h3>
<p data-lang-text="–ì–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –ø—Ä–æ–∫–∞—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π|Gems, accounts, character boost">–ì–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –ø—Ä–æ–∫–∞—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">100‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$1.1</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨1.0</div></div>
</div>
<button class="btn" onclick="buyProduct('Brawl Stars', 100)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-roblox">
<div>
<div class="game-icon">üéÆ</div>
<h3 data-lang-text="Roblox|Roblox">Roblox</h3>
<p data-lang-text="Robux, –∏–≥—Ä–æ–≤—ã–µ –≤–∞–ª—é—Ç—ã, –ø—Ä–µ–º–∏—É–º|Robux, game currency, premium">Robux, –∏–≥—Ä–æ–≤—ã–µ –≤–∞–ª—é—Ç—ã, –ø—Ä–µ–º–∏—É–º</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">150‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$1.6</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨1.5</div></div>
</div>
<button class="btn" onclick="buyProduct('Roblox', 150)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-csgo">
<div>
<div class="game-icon">üî´</div>
<h3 data-lang-text="CS:GO|CS:GO">CS:GO</h3>
<p data-lang-text="–°–∫–∏–Ω—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –±—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞|Skins, accounts, rank boost">–°–∫–∏–Ω—ã, –∞–∫–∫–∞—É–Ω—Ç—ã, –±—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">200‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$2.2</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨2.0</div></div>
</div>
<button class="btn" onclick="buyProduct('CS:GO', 200)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-minecraft">
<div>
<div class="game-icon">‚öîÔ∏è</div>
<h3 data-lang-text="Minecraft|Minecraft">Minecraft</h3>
<p data-lang-text="–ê–∫–∫–∞—É–Ω—Ç—ã, –¥–æ–Ω–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏|Accounts, server donations, perks">–ê–∫–∫–∞—É–Ω—Ç—ã, –¥–æ–Ω–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">50‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$0.5</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨0.5</div></div>
</div>
<button class="btn" onclick="buyProduct('Minecraft', 50)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-valorant">
<div>
<div class="game-icon">üéØ</div>
<h3 data-lang-text="Valorant|Valorant">Valorant</h3>
<p data-lang-text="VP –æ—á–∫–∏, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –ø—Ä–æ–∫–∞—á–∫–∞|VP points, weapon skins, boosting">VP –æ—á–∫–∏, —Å–∫–∏–Ω—ã –æ—Ä—É–∂–∏—è, –ø—Ä–æ–∫–∞—á–∫–∞</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">300‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$3.3</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨3.0</div></div>
</div>
<button class="btn" onclick="buyProduct('Valorant', 300)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-fortnite">
<div>
<div class="game-icon">üèÜ</div>
<h3 data-lang-text="Fortnite|Fortnite">Fortnite</h3>
<p data-lang-text="V-Bucks, –±–∞—Ç–ª-–ø–∞—Å—Å, —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–Ω—ã|V-Bucks, battle pass, exclusive skins">V-Bucks, –±–∞—Ç–ª-–ø–∞—Å—Å, —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–Ω—ã</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">250‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$2.7</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨2.5</div></div>
</div>
<button class="btn" onclick="buyProduct('Fortnite', 250)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-genshin">
<div>
<div class="game-icon">‚ö°</div>
<h3 data-lang-text="Genshin Impact|Genshin Impact">Genshin Impact</h3>
<p data-lang-text="–ü—Ä–∏–º–æ–≥–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏|Primogems, character accounts">–ü—Ä–∏–º–æ–≥–µ–º—ã, –∞–∫–∫–∞—É–Ω—Ç—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">100‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$1.1</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨1.0</div></div>
</div>
<button class="btn" onclick="buyProduct('Genshin Impact', 100)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-telegram">
<div>
<div class="game-icon">‚≠ê</div>
<h3 data-lang-text="Telegram Stars|Telegram Stars">Telegram Stars</h3>
<p data-lang-text="–ó–≤–µ–∑–¥—ã –¥–ª—è –¥–æ–Ω–∞—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫|Stars for donations and subscriptions">–ó–≤–µ–∑–¥—ã –¥–ª—è –¥–æ–Ω–∞—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">80‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$0.9</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨0.8</div></div>
</div>
<button class="btn" onclick="buyProduct('Telegram Stars', 80)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

<div class="game-card card-steam">
<div>
<div class="game-icon">üéÆ</div>
<h3 data-lang-text="Steam|Steam">Steam</h3>
<p data-lang-text="–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞, –∏–≥—Ä—ã, –ø–æ–¥–∞—Ä–∫–∏|Wallet top-up, games, gifts">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞, –∏–≥—Ä—ã, –ø–æ–¥–∞—Ä–∫–∏</p>
</div>
<div>
<div class="price-row">
<div class="price-item"><div class="price-label">RUB</div><div class="price-value">100‚ÇΩ</div></div>
<div class="price-item"><div class="price-label">USD</div><div class="price-value">$1.1</div></div>
<div class="price-item"><div class="price-label">EUR</div><div class="price-value">‚Ç¨1.0</div></div>
</div>
<button class="btn" onclick="buyProduct('Steam', 100)" data-lang-text="–ö—É–ø–∏—Ç—å|Buy">–ö—É–ø–∏—Ç—å</button>
</div>
</div>

</div>
</div>

<div class="footer" id="contact">
<h3 data-lang-text="üéÉ –°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π|üéÉ Contact Me">üéÉ –°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π</h3>
<p data-lang-text="–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏ –≤ Telegram –∏–ª–∏ –Ω–∞ Email!|Questions? DM on Telegram or Email!">–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏ –≤ Telegram –∏–ª–∏ –Ω–∞ Email!</p>
<div class="contact">
<a href="https://t.me/lowv1rre" target="_blank">üì± @lowv1rre</a>
<a href="mailto:lowv1re1@gmail.com">üìß lowv1re1@gmail.com</a>
</div>
<p style="margin-top:30px;color:#888;font-size:14px;">¬© 2024 LOWV1RE. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
</div>
</div>

<div class="modal" id="loginModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('loginModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç|Login">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
<div id="loginError"></div>
<div class="form-group">
<label data-lang-text="Email|Email">Email</label>
<input type="email" id="loginEmail" placeholder="your@email.com" oninput="validateEmailInput(this, 'loginEmailError')">
<div id="loginEmailError"></div>
</div>
<div class="form-group">
<label data-lang-text="–ü–∞—Ä–æ–ª—å|Password">–ü–∞—Ä–æ–ª—å</label>
<input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
</div>
<button class="form-submit" onclick="login()" data-lang-text="–í–æ–π—Ç–∏|Login">–í–æ–π—Ç–∏</button>
<div class="form-switch">
<span data-lang-text="–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?|Don't have an account?">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span>
<a onclick="switchModal('loginModal', 'registerModal')" data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è|Register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
</div>
<div class="form-switch" style="margin-top:10px;">
<a onclick="switchModal('loginModal', 'forgotModal')" data-lang-text="–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å –∏–ª–∏ –∏–º—è?|Forgot password or username?">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å –∏–ª–∏ –∏–º—è?</a>
</div>
</div>
</div>

<div class="modal" id="registerModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('registerModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è|Registration">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
<div id="registerError"></div>
<div class="form-group">
<label data-lang-text="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è|Username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
<input type="text" id="registerUsername" placeholder="username" oninput="validateUsernameInput(this)">
<div id="usernameError"></div>
</div>
<div class="form-group">
<label data-lang-text="Email|Email">Email</label>
<input type="email" id="registerEmail" placeholder="your@email.com" oninput="validateEmailInput(this, 'emailError')">
<div id="emailError"></div>
</div>
<div class="form-group">
<label data-lang-text="–ü–∞—Ä–æ–ª—å|Password">–ü–∞—Ä–æ–ª—å</label>
<input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
</div>
<button class="form-submit" id="registerBtn" onclick="register()" data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
<div class="form-switch">
<span data-lang-text="–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?|Already have an account?">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</span>
<a onclick="switchModal('registerModal', 'loginModal')" data-lang-text="–í–æ–π—Ç–∏|Login">–í–æ–π—Ç–∏</a>
</div>
</div>
</div>

<div class="modal" id="verifyEmailModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('verifyEmailModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏|Registration Confirmation">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
<div id="verifyError"></div>
<p style="text-align:center;color:#aaa;margin-bottom:20px;" data-lang-text="üéÉ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.|üéÉ Enter the code sent to your email to complete registration.">üéÉ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.</p>
<div class="form-group">
<label data-lang-text="–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (6 —Ü–∏—Ñ—Ä)|Verification code (6 digits)">–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (6 —Ü–∏—Ñ—Ä)</label>
<input type="text" id="verifyCode" placeholder="000000" maxlength="6" style="text-align:center;font-size:24px;letter-spacing:5px;">
</div>
<button class="form-submit" id="verifyBtn" onclick="verifyEmailCode()" data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
<div class="form-switch" style="margin-top:15px;">
<a onclick="resendVerificationCode()" data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ|Resend code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ</a>
</div>
</div>
</div>

<div class="modal" id="forgotModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('forgotModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ|Recovery">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</h2>
<div id="forgotError"></div>
<div class="form-group">
<label data-lang-text="–ß—Ç–æ –≤—ã –∑–∞–±—ã–ª–∏?|What did you forget?">–ß—Ç–æ –≤—ã –∑–∞–±—ã–ª–∏?</label>
<select id="forgotType">
<option value="password" data-lang-text="–ü–∞—Ä–æ–ª—å|Password">–ü–∞—Ä–æ–ª—å</option>
<option value="username" data-lang-text="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è|Username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
</select>
</div>
<div class="form-group">
<label data-lang-text="–í–∞—à Email|Your Email">–í–∞—à Email</label>
<input type="email" id="forgotEmail" placeholder="your@email.com" oninput="validateEmailInput(this, 'forgotEmailError')">
<div id="forgotEmailError"></div>
</div>
<button class="form-submit" id="forgotBtn" onclick="sendRecovery()" data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥|Send code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
<div class="form-switch">
<a onclick="switchModal('forgotModal', 'loginModal')" data-lang-text="–ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É|Back to login">–ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É</a>
</div>
</div>
</div>

<div class="modal" id="resetModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('resetModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è|Password Reset">–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h2>
<div id="resetError"></div>
<p style="text-align:center;color:#aaa;margin-bottom:20px;" data-lang-text="üíÄ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å.|üíÄ Enter the code to reset your password.">üíÄ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å.</p>
<div class="form-group">
<label data-lang-text="–ö–æ–¥ –∏–∑ –ø–∏—Å—å–º–∞ (6 —Ü–∏—Ñ—Ä)|Code from email (6 digits)">–ö–æ–¥ –∏–∑ –ø–∏—Å—å–º–∞ (6 —Ü–∏—Ñ—Ä)</label>
<input type="text" id="resetCode" placeholder="000000" maxlength="6" style="text-align:center;font-size:24px;letter-spacing:5px;">
</div>
<button class="form-submit" id="resetBtn" onclick="verifyCode()" data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</button>
<div class="form-switch" style="margin-top:15px;">
<a onclick="resendCode()" data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ|Resend code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ</a>
</div>
</div>
</div>

<div class="modal" id="newPasswordModal">
<div class="modal-content">
<span class="modal-close" onclick="closeModal('newPasswordModal')">&times;</span>
<h2 class="modal-title" data-lang-text="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å|New password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</h2>
<div id="newPasswordError"></div>
<div class="form-group">
<label data-lang-text="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å|New password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
<input type="password" id="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
</div>
<div class="form-group">
<label data-lang-text="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å|Repeat password">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
<input type="password" id="newPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
</div>
<button class="form-submit" id="newPasswordBtn" onclick="saveNewPassword()" data-lang-text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å|Save password">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
</div>
</div>

<script>
const SUPABASE_URL = 'https://nbelgmhtxjjlfpqmkqbl.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5iZWxnbWh0eGpqbGZwcW1rcWJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NDg2OTcsImV4cCI6MjA3NzQyNDY5N30.6snueQkGb7LorM_qhVNHdxUOC90FypoVzxllniwn70Q';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let currentUser = null;
let currentLang = 'ru';
let recoveryEmail = '';
let verifiedCode = '';
let pendingRegistration = null;

// –û—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ Edge Function
async function sendEmailCode(email, code, type = 'registration') {
    try {
        const response = await fetch('https://nbelgmhtxjjlfpqmkqbl.supabase.co/functions/v1/send-recovery-code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${SUPABASE_KEY}`
            },
            body: JSON.stringify({
                email: email,
                code: code
            })
        });
        
        if (!response.ok) {
            const error = await response.json();
            console.error('Edge Function error:', error);
            return false;
        }
        
        const data = await response.json();
        console.log('‚úÖ Email —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ Edge Function!', data);
        return true;
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ Edge Function:', error);
        return false;
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ (000001-999999)
function generateCode() {
    const code = Math.floor(Math.random() * 999999) + 1;
    return code.toString().padStart(6, '0');
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è email
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è username (—Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)
function isValidUsername(username) {
    const usernameRegex = /^[a-zA-Z0-9]+$/;
    return usernameRegex.test(username);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ username –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function validateUsernameInput(input) {
    const value = input.value;
    const errorDiv = document.getElementById('usernameError');
    
    if (value && !isValidUsername(value)) {
        input.style.borderColor = '#ff4444';
        input.style.boxShadow = '0 0 10px rgba(255, 68, 68, 0.5)';
        errorDiv.innerHTML = '<div class="error-msg" style="margin-top:5px;">Username –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã (a-z) –∏ —Ü–∏—Ñ—Ä—ã (0-9)</div>';
    } else {
        input.style.borderColor = 'rgba(255,140,0,0.4)';
        input.style.boxShadow = 'none';
        errorDiv.innerHTML = '';
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ email –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function validateEmailInput(input, errorDivId) {
    const value = input.value.trim();
    const errorDiv = document.getElementById(errorDivId);
    
    if (value && !isValidEmail(value)) {
        input.style.borderColor = '#ff4444';
        input.style.boxShadow = '0 0 10px rgba(255, 68, 68, 0.5)';
        if (!errorDiv.querySelector('.error-msg')) {
            errorDiv.innerHTML = '<div class="error-msg" style="margin-top:5px;">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email (–Ω–∞–ø—Ä–∏–º–µ—Ä: name@example.com)</div>';
        }
    } else {
        input.style.borderColor = 'rgba(255,140,0,0.4)';
        input.style.boxShadow = 'none';
        if (errorDiv.querySelector('.error-msg') && errorDiv.textContent.includes('email')) {
            errorDiv.innerHTML = '';
        }
    }
}

// –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
function clearForm(formId) {
    const inputs = document.querySelectorAll(`#${formId} input`);
    inputs.forEach(input => input.value = '');
}

// –û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
function clearMessages(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        element.innerHTML = '';
    }
}

window.addEventListener('load', async () => {
    await checkAuth();
    updateLangText();
});

async function checkAuth() {
    const { data: { user } } = await supabase.auth.getUser();
    if (user) {
        const { data: userData } = await supabase.from('users').select('*').eq('email', user.email).maybeSingle();
        if (userData) {
            currentUser = userData;
            showUserProfile();
        }
    } else {
        showAuthButton();
    }
}

function showAuthButton() {
    document.getElementById('authSection').innerHTML = '<button class="auth-btn" onclick="openModal(\'loginModal\')" data-lang-text="–í–æ–π—Ç–∏|Login">–í–æ–π—Ç–∏</button>';
    document.getElementById('profileSection').style.display = 'none';
    updateLangText();
}

function showUserProfile() {
    const avatar = currentUser.username.charAt(0).toUpperCase();
    document.getElementById('authSection').innerHTML = `<div class="user-info" onclick="toggleProfile()"><div class="user-avatar">${avatar}</div><div class="user-name">${currentUser.username}</div></div>`;
    document.getElementById('profileAvatar').textContent = avatar;
    document.getElementById('profileUsername').textContent = currentUser.username;
    document.getElementById('profileEmail').textContent = currentUser.email;
    document.getElementById('profileUrl').textContent = `lowv1re.eu/user${currentUser.id}`;
    document.getElementById('profileBalance').textContent = `${currentUser.balance}‚ÇΩ`;
    const date = new Date(currentUser.created_at);
    document.getElementById('profileDate').textContent = date.toLocaleDateString('ru-RU');
}

function toggleProfile() {
    const profile = document.getElementById('profileSection');
    const games = document.getElementById('games');
    if (profile.style.display === 'none') {
        profile.style.display = 'block';
        games.style.display = 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    } else {
        profile.style.display = 'none';
        games.style.display = 'block';
    }
}

async function register() {
    const username = document.getElementById('registerUsername').value.trim();
    const email = document.getElementById('registerEmail').value.trim().toLowerCase();
    const password = document.getElementById('registerPassword').value;
    const errorDiv = document.getElementById('registerError');
    const btn = document.getElementById('registerBtn');
    
    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    errorDiv.innerHTML = '';
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π
    if (!username || !email || !password) {
        errorDiv.innerHTML = '<div class="error-msg">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!</div>';
        return;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è username
    if (!isValidUsername(username)) {
        errorDiv.innerHTML = '<div class="error-msg">Username –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã (a-z) –∏ —Ü–∏—Ñ—Ä—ã (0-9)</div>';
        return;
    }
    
    if (username.length < 3) {
        errorDiv.innerHTML = '<div class="error-msg">Username –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞</div>';
        return;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è email
    if (!isValidEmail(email)) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email!</div>';
        return;
    }
    
    if (password.length < 6) {
        errorDiv.innerHTML = '<div class="error-msg">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!</div>';
        return;
    }
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞...|Sending code...">–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞...</span>';
    
    try {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è username
        const { data: existingUser } = await supabase
            .from('users')
            .select('username')
            .eq('username', username)
            .maybeSingle();
        
        if (existingUser) {
            errorDiv.innerHTML = '<div class="error-msg">–≠—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>';
            updateLangText();
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email
        const { data: existingEmail } = await supabase
            .from('users')
            .select('email')
            .eq('email', email)
            .maybeSingle();
        
        if (existingEmail) {
            errorDiv.innerHTML = '<div class="error-msg">–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>';
            updateLangText();
            return;
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
        const code = generateCode();
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–¥—ã –¥–ª—è —ç—Ç–æ–≥–æ email
        await supabase.from('recovery_codes').delete().eq('email', email);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ –ë–î
        const expiresAt = new Date();
        expiresAt.setMinutes(expiresAt.getMinutes() + 10);
        
        const { error: codeError } = await supabase.from('recovery_codes').insert([{
            email: email,
            code: code,
            expires_at: expiresAt.toISOString(),
            used: false
        }]);
        
        if (codeError) throw codeError;
        
        // –í—Ä–µ–º–µ–Ω–Ω–æ: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–¥–ª—è —Ç–µ—Å—Ç–∞)
        console.log('===================');
        console.log('–ö–û–î –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò:', code);
        console.log('EMAIL:', email);
        console.log('===================');
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Resend API –Ω–∞–ø—Ä—è–º—É—é
        const emailSent = await sendEmailCode(email, code, 'registration');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        pendingRegistration = { username, email, password };
        
        // –°—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –º–æ–¥–∞–ª–∫—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞ (–ë–ï–ó –∑–∞–¥–µ—Ä–∂–∫–∏!)
        closeModal('registerModal');
        openModal('verifyEmailModal');
        document.getElementById('verifyCode').focus();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –£–ñ–ï –≤ –Ω–æ–≤–æ–π –º–æ–¥–∞–ª–∫–µ
        const verifyErrorDiv = document.getElementById('verifyError');
        if (emailSent) {
            verifyErrorDiv.innerHTML = '<div class="success-msg">‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É!</div>';
        } else {
            verifyErrorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –ø—Ä–∏—à—ë–ª - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)</div>';
        }
        
    } catch (error) {
        console.error('Registration error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è|Register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>';
        updateLangText();
    }
}

async function verifyEmailCode() {
    const code = document.getElementById('verifyCode').value.trim();
    const errorDiv = document.getElementById('verifyError');
    const btn = document.getElementById('verifyBtn');
    
    errorDiv.innerHTML = '';
    
    if (!code || code.length !== 6) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥!</div>';
        return;
    }
    
    if (!pendingRegistration) {
        errorDiv.innerHTML = '<div class="error-msg">–û—à–∏–±–∫–∞! –ù–∞—á–Ω–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ.</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∫–∞...|Verifying...">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>';
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥
        const { data: codeData, error } = await supabase
            .from('recovery_codes')
            .select('*')
            .eq('email', pendingRegistration.email)
            .eq('code', code)
            .eq('used', false)
            .maybeSingle();
        
        if (error || !codeData) {
            errorDiv.innerHTML = '<div class="error-msg">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>';
            updateLangText();
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ–º UTC timestamp –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
        const expiresAt = new Date(codeData.expires_at);
        const now = new Date();
        
        console.log('‚è∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:');
        console.log('   –°–µ–π—á–∞—Å:', now.toISOString());
        console.log('   –ò—Å—Ç–µ–∫–∞–µ—Ç:', expiresAt.toISOString());
        console.log('   –†–∞–∑–Ω–∏—Ü–∞ (–º–∏–Ω—É—Ç):', (expiresAt - now) / 60000);
        
        if (now.getTime() > expiresAt.getTime()) {
            errorDiv.innerHTML = '<div class="error-msg">–ö–æ–¥ –∏—Å—Ç—ë–∫! –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥.</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>';
            updateLangText();
            return;
        }
        
        errorDiv.innerHTML = '<div class="success-msg">Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω! –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞...</div>';
        
        // –û—Ç–º–µ—á–∞–µ–º –∫–æ–¥ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
        await supabase.from('recovery_codes').update({ used: true }).eq('code', code);
        
        // –°–æ–∑–¥–∞—ë–º –∞–∫–∫–∞—É–Ω—Ç –≤ Supabase Auth
        const { data: authData, error: authError } = await supabase.auth.signUp({
            email: pendingRegistration.email,
            password: pendingRegistration.password,
            options: { emailRedirectTo: window.location.origin }
        });
        
        if (authError) throw authError;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É users
        const { error: dbError } = await supabase.from('users').insert([{
            username: pendingRegistration.username,
            email: pendingRegistration.email,
            is_admin: false,
            balance: 1000
        }]);
        
        if (dbError) throw dbError;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç
        const { data: loginData, error: loginError } = await supabase.auth.signInWithPassword({
            email: pendingRegistration.email,
            password: pendingRegistration.password
        });
        
        if (loginError) throw loginError;
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const { data: finalUserData } = await supabase
            .from('users')
            .select('*')
            .eq('email', pendingRegistration.email)
            .single();
        
        currentUser = finalUserData;
        
        errorDiv.innerHTML = '<div class="success-msg">‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>';
        
        setTimeout(() => {
            closeModal('verifyEmailModal');
            showUserProfile();
            pendingRegistration = null;
        }, 1500);
        
    } catch (error) {
        console.error('Verification error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å|Verify">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>';
        updateLangText();
    }
}

async function resendVerificationCode() {
    if (!pendingRegistration) {
        alert('–û—à–∏–±–∫–∞! –ù–∞—á–Ω–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ.');
        return;
    }
    
    const errorDiv = document.getElementById('verifyError');
    errorDiv.innerHTML = '<div class="success-msg">–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞...</div>';
    
    const code = generateCode();
    
    try {
        await supabase.from('recovery_codes').delete().eq('email', pendingRegistration.email);
        
        const expiresAt = new Date();
        expiresAt.setMinutes(expiresAt.getMinutes() + 10);
        
        await supabase.from('recovery_codes').insert([{
            email: pendingRegistration.email,
            code: code,
            expires_at: expiresAt.toISOString(),
            used: false
        }]);
        
        console.log('===================');
        console.log('–ù–û–í–´–ô –ö–û–î:', code);
        console.log('EMAIL:', pendingRegistration.email);
        console.log('===================');
        
        const emailSent = await sendEmailCode(pendingRegistration.email, code, 'registration');
        
        if (emailSent) {
            errorDiv.innerHTML = '<div class="success-msg">‚úÖ –ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ—á—Ç—É!</div>';
        } else {
            errorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ù–æ–≤—ã–π –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12)!</div>';
        }
        
        document.getElementById('verifyCode').value = '';
        document.getElementById('verifyCode').focus();
    } catch (error) {
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    }
}

async function login() {
    const email = document.getElementById('loginEmail').value.trim().toLowerCase();
    const password = document.getElementById('loginPassword').value;
    const errorDiv = document.getElementById('loginError');
    
    errorDiv.innerHTML = '';
    
    if (!email || !password) {
        errorDiv.innerHTML = '<div class="error-msg">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!</div>';
        return;
    }
    
    if (!isValidEmail(email)) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email!</div>';
        return;
    }
    
    try {
        const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
            email: email, 
            password: password
        });
        
        if (authError) {
            errorDiv.innerHTML = '<div class="error-msg">–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å!</div>';
            return;
        }
        
        const { data: userData, error: dbError } = await supabase
            .from('users')
            .select('*')
            .eq('email', email)
            .maybeSingle();
        
        if (!userData) {
            errorDiv.innerHTML = '<div class="error-msg">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!</div>';
            return;
        }
        
        currentUser = userData;
        closeModal('loginModal');
        showUserProfile();
    } catch (error) {
        errorDiv.innerHTML = '<div class="error-msg">–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</div>';
        console.error(error);
    }
}

async function logout() {
    await supabase.auth.signOut();
    currentUser = null;
    showAuthButton();
    document.getElementById('profileSection').style.display = 'none';
    document.getElementById('games').style.display = 'block';
}

async function buyProduct(productName, price) {
    if (!currentUser) {
        openModal('loginModal');
        return;
    }
    if (currentUser.balance < price) {
        alert(currentLang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!' : 'Insufficient balance!');
        return;
    }
    try {
        const { data: product } = await supabase
            .from('products')
            .select('id')
            .eq('name', productName)
            .maybeSingle();
        
        if (!product) {
            alert(currentLang === 'ru' ? '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!' : 'Product not found!');
            return;
        }
        
        const { error: orderError } = await supabase
            .from('orders')
            .insert([{
                user_id: currentUser.id, 
                product_id: product.id, 
                amount: price, 
                status: 'pending'
            }]);
        
        if (orderError) throw orderError;
        
        const newBalance = currentUser.balance - price;
        const { error: balanceError } = await supabase
            .from('users')
            .update({ balance: newBalance })
            .eq('id', currentUser.id);
        
        if (balanceError) throw balanceError;
        
        currentUser.balance = newBalance;
        document.getElementById('profileBalance').textContent = `${newBalance}‚ÇΩ`;
        
        alert(currentLang === 'ru' 
            ? `–¢–æ–≤–∞—Ä "${productName}" –∫—É–ø–ª–µ–Ω! –°–≤—è–∂–∏—Ç–µ—Å—å —Å @lowv1rre –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è.` 
            : `Product "${productName}" purchased! Contact @lowv1rre to receive.`);
    } catch (error) {
        alert(currentLang === 'ru' ? '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ!' : 'Purchase error!');
        console.error(error);
    }
}

function openModal(modalId) { 
    clearMessages(modalId.replace('Modal', 'Error'));
    document.getElementById(modalId).classList.add('active'); 
}

function closeModal(modalId) { 
    document.getElementById(modalId).classList.remove('active');
    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    clearForm(modalId);
    clearMessages(modalId.replace('Modal', 'Error'));
}

function switchModal(from, to) { 
    closeModal(from); 
    openModal(to); 
}

async function sendRecovery() {
    const email = document.getElementById('forgotEmail').value.trim().toLowerCase();
    const type = document.getElementById('forgotType').value;
    const errorDiv = document.getElementById('forgotError');
    const btn = document.getElementById('forgotBtn');
    
    errorDiv.innerHTML = '';
    
    if (!email) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ email!</div>';
        return;
    }
    
    if (!isValidEmail(email)) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email!</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–û—Ç–ø—Ä–∞–≤–∫–∞...|Sending...">–û—Ç–ø—Ä–∞–≤–∫–∞...</span>';
    
    try {
        const { data: userData } = await supabase
            .from('users')
            .select('*')
            .eq('email', email)
            .maybeSingle();
        
        if (!userData) {
            errorDiv.innerHTML = '<div class="error-msg">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥|Send code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</span>';
            updateLangText();
            return;
        }
        
        if (type === 'username') {
            errorDiv.innerHTML = `<div class="success-msg">–í–∞—à–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <strong>${userData.username}</strong></div>`;
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥|Send code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</span>';
            updateLangText();
            return;
        }
        
        if (type === 'password') {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥
            const code = generateCode();
            
            await supabase.from('recovery_codes').delete().eq('email', email);
            
            const expiresAt = new Date();
            expiresAt.setMinutes(expiresAt.getMinutes() + 10);
            
            await supabase.from('recovery_codes').insert([{
                email: email,
                code: code,
                expires_at: expiresAt.toISOString(),
                used: false
            }]);
            
            console.log('===================');
            console.log('–ö–û–î –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø:', code);
            console.log('EMAIL:', email);
            console.log('===================');
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Resend API
            const emailSent = await sendEmailCode(email, code, 'recovery');
            
            recoveryEmail = email;
            
            if (emailSent) {
                errorDiv.innerHTML = '<div class="success-msg">‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ—á—Ç—É! –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤–≤–æ–¥—É –∫–æ–¥–∞...</div>';
            } else {
                errorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ö–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12)! –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤–≤–æ–¥—É –∫–æ–¥–∞...</div>';
            }
            
            setTimeout(() => {
                closeModal('forgotModal');
                openModal('resetModal');
                document.getElementById('resetCode').focus();
            }, 1500);
        }
    } catch (error) {
        console.error('Recovery error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥|Send code">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</span>';
        updateLangText();
    }
}

async function verifyCode() {
    const code = document.getElementById('resetCode').value.trim();
    const errorDiv = document.getElementById('resetError');
    const btn = document.getElementById('resetBtn');
    
    errorDiv.innerHTML = '';
    
    if (!code || code.length !== 6) {
        errorDiv.innerHTML = '<div class="error-msg">–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥!</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∫–∞...|Verifying...">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>';
    
    try {
        const { data: codeData, error } = await supabase
            .from('recovery_codes')
            .select('*')
            .eq('email', recoveryEmail)
            .eq('code', code)
            .eq('used', false)
            .maybeSingle();
        
        if (error || !codeData) {
            errorDiv.innerHTML = '<div class="error-msg">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</span>';
            updateLangText();
            return;
        }
        
        const expiresAt = new Date(codeData.expires_at);
        const now = new Date();
        
        console.log('‚è∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:');
        console.log('   –°–µ–π—á–∞—Å:', now.toISOString());
        console.log('   –ò—Å—Ç–µ–∫–∞–µ—Ç:', expiresAt.toISOString());
        console.log('   –†–∞–∑–Ω–∏—Ü–∞ (–º–∏–Ω—É—Ç):', (expiresAt - now) / 60000);
        
        if (now.getTime() > expiresAt.getTime()) {
            errorDiv.innerHTML = '<div class="error-msg">–ö–æ–¥ –∏—Å—Ç—ë–∫! –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π.</div>';
            btn.disabled = false;
            btn.innerHTML = '<span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</span>';
            updateLangText();
            return;
        }
        
        verifiedCode = code;
        errorDiv.innerHTML = '<div class="success-msg">–ö–æ–¥ –≤–µ—Ä–µ–Ω!</div>';
        
        setTimeout(() => {
            closeModal('resetModal');
            openModal('newPasswordModal');
            document.getElementById('newPassword').focus();
        }, 1000);
        
    } catch (error) {
        console.error('Code verification error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥|Verify code">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</span>';
        updateLangText();
    }
}

async function resendCode() {
    if (!recoveryEmail) {
        alert('–û—à–∏–±–∫–∞! –ù–∞—á–Ω–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ.');
        return;
    }
    
    const errorDiv = document.getElementById('resetError');
    errorDiv.innerHTML = '<div class="success-msg">–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞...</div>';
    
    const code = generateCode();
    
    try {
        await supabase.from('recovery_codes').delete().eq('email', recoveryEmail);
        
        const expiresAt = new Date();
        expiresAt.setMinutes(expiresAt.getMinutes() + 10);
        
        await supabase.from('recovery_codes').insert([{
            email: recoveryEmail,
            code: code,
            expires_at: expiresAt.toISOString(),
            used: false
        }]);
        
        console.log('===================');
        console.log('–ù–û–í–´–ô –ö–û–î –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø:', code);
        console.log('EMAIL:', recoveryEmail);
        console.log('===================');
        
        const emailSent = await sendEmailCode(recoveryEmail, code, 'recovery');
        
        if (emailSent) {
            errorDiv.innerHTML = '<div class="success-msg">‚úÖ –ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!</div>';
        } else {
            errorDiv.innerHTML = '<div class="success-msg">‚ö†Ô∏è –ù–æ–≤—ã–π –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12)!</div>';
        }
        
        document.getElementById('resetCode').value = '';
        document.getElementById('resetCode').focus();
    } catch (error) {
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    }
}

async function saveNewPassword() {
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('newPasswordConfirm').value;
    const errorDiv = document.getElementById('newPasswordError');
    const btn = document.getElementById('newPasswordBtn');
    
    errorDiv.innerHTML = '';
    
    if (!newPassword || !confirmPassword) {
        errorDiv.innerHTML = '<div class="error-msg">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!</div>';
        return;
    }
    
    if (newPassword !== confirmPassword) {
        errorDiv.innerHTML = '<div class="error-msg">–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!</div>';
        return;
    }
    
    if (newPassword.length < 6) {
        errorDiv.innerHTML = '<div class="error-msg">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!</div>';
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span><span data-lang-text="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...|Saving...">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>';
    
    try {
        // –û—Ç–º–µ—á–∞–µ–º –∫–æ–¥ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
        await supabase
            .from('recovery_codes')
            .update({ used: true })
            .eq('code', verifiedCode);
        
        // –ü–æ–ª—É—á–∞–µ–º user ID
        const { data: userData } = await supabase
            .from('users')
            .select('id')
            .eq('email', recoveryEmail)
            .single();
        
        if (!userData) throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
        
        // –í—Ö–æ–¥–∏–º –≤ –∞–∫–∫–∞—É–Ω—Ç (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è)
        const { error: signInError } = await supabase.auth.signInWithPassword({
            email: recoveryEmail,
            password: newPassword // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å (–∫–æ—Ç–æ—Ä—ã–π –º—ã –Ω–µ –∑–Ω–∞–µ–º)
        });
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º updateUser –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
        const { error: updateError } = await supabase.auth.updateUser({
            password: newPassword
        });
        
        if (updateError) {
            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —á–µ—Ä–µ–∑ updateUser, –∏—Å–ø–æ–ª—å–∑—É–µ–º admin API
            console.log('Trying admin update...');
            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.');
        }
        
        errorDiv.innerHTML = '<div class="success-msg">üí• –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.</div>';
        
        setTimeout(() => {
            closeModal('newPasswordModal');
            openModal('loginModal');
            document.getElementById('loginEmail').value = recoveryEmail;
            recoveryEmail = '';
            verifiedCode = '';
        }, 2500);
        
    } catch (error) {
        console.error('Password save error:', error);
        errorDiv.innerHTML = `<div class="error-msg">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span data-lang-text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å|Save password">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</span>';
        updateLangText();
    }
}

const langSwitch = document.getElementById('langSwitch');
langSwitch.addEventListener('click', () => {
    currentLang = currentLang === 'ru' ? 'en' : 'ru';
    langSwitch.textContent = currentLang.toUpperCase();
    updateLangText();
});

function updateLangText() {
    document.querySelectorAll('[data-lang-text]').forEach(el => {
        const texts = el.dataset.langText.split('|');
        if (el.tagName === 'OPTION') {
            el.textContent = currentLang === 'ru' ? texts[0] : texts[1];
        } else {
            el.innerHTML = currentLang === 'ru' ? texts[0] : texts[1];
        }
    });
}

let lastScroll = 0;
const header = document.getElementById('header');
const HEADER_HIDE_POINT = 150;

window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > HEADER_HIDE_POINT) {
        if (currentScroll > lastScroll) {
            header.classList.add('hidden');
        }
    } else {
        header.classList.remove('hidden');
    }
    
    lastScroll = currentScroll;
});
</script>
</body>
</html>
